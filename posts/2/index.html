
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>柯小小西の小水滴</title>
  <meta name="author" content="柯小小西">

  
  <meta name="description" content="柯小小西の小水滴">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://kxcoder.github.io/posts/2/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="柯小小西の小水滴" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
   <script src="http://ajax.useso.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
    <script src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js" type="text/javascript" charset="utf-8"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!-- 使用360 CDN 代理 解决google字体 GFW问题 -->
<link href="//fonts.useso.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.useso.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">




</head>

<body   >
  <header role="banner"><hgroup>
  <div style="float:left; width: 500px">
    <h1><a href="/">柯小小西の小水滴</a></h1>
    
      <h2>聚合各路水滴，方可成为大海.</h2>
    
  </div>
  
    <div style="float:right">
      <p style="font-family:cursive;font-size:80%;color:yellow;font-style:oblique">
         始终坚信，好记忆不如烂笔头。 
      </p>
<ul id="social-links">
  <!-- Sina Weibo -->
  <li>
    <a href="http://weibo.com/2265041632" target="_blank">
      <svg width="40" height="40" class="sina-weibo" version="1.1" xmlns="http://www.w3.org/2000/svg">
        <path fill="#000000" d="M9.641,17.231c-3.799,0.374-7.079-1.343-7.326-3.838c-0.246-2.494,2.634-4.82,6.434-5.196 c3.798-0.377,7.079,1.34,7.326,3.835C16.32,14.529,13.44,16.855,9.641,17.231 M17.24,8.952c-0.322-0.098-0.544-0.163-0.375-0.587 c0.365-0.921,0.403-1.718,0.007-2.286c-0.745-1.063-2.783-1.005-5.12-0.027c0-0.002-0.734,0.321-0.546-0.261 c0.359-1.156,0.305-2.123-0.254-2.682c-1.267-1.271-4.639,0.047-7.53,2.936C1.257,8.209,0,10.504,0,12.488 c0,3.796,4.866,6.104,9.628,6.104c6.241,0,10.393-3.627,10.393-6.506C20.021,10.347,18.557,9.358,17.24,8.952" />
        <path fill="#000000" d="M21.384,2.005c-1.507-1.671-3.73-2.308-5.782-1.872l0,0c-0.475,0.102-0.778,0.569-0.676,1.043 c0.101,0.473,0.567,0.777,1.043,0.674c1.459-0.31,3.039,0.145,4.111,1.332c1.069,1.188,1.362,2.806,0.902,4.225v0.001 c-0.149,0.462,0.104,0.957,0.566,1.106c0.461,0.149,0.956-0.104,1.105-0.565c0,0,0-0.002,0-0.004 C23.299,5.95,22.894,3.674,21.384,2.005" />
        <path fill="#000000" d="M19.07,4.094c-0.734-0.814-1.817-1.123-2.817-0.912c-0.409,0.088-0.671,0.49-0.581,0.899 c0.088,0.407,0.489,0.67,0.896,0.58v0.001c0.488-0.104,1.019,0.047,1.379,0.445c0.359,0.398,0.455,0.941,0.301,1.416l0,0 c-0.127,0.398,0.09,0.825,0.488,0.954c0.396,0.127,0.824-0.091,0.952-0.488C20,6.017,19.805,4.908,19.07,4.094" />
        <path fill="#000000" d="M9.85,12.713c-0.132,0.229-0.426,0.338-0.656,0.242c-0.227-0.094-0.297-0.348-0.169-0.572 c0.132-0.221,0.416-0.328,0.64-0.239C9.895,12.227,9.978,12.483,9.85,12.713 M8.64,14.268c-0.367,0.586-1.154,0.843-1.747,0.57 c-0.584-0.265-0.756-0.945-0.389-1.518c0.362-0.568,1.124-0.824,1.712-0.574C8.811,12.998,9.001,13.675,8.64,14.268 M10.021,10.118 c-1.808-0.47-3.852,0.431-4.637,2.023c-0.8,1.624-0.026,3.428,1.801,4.017c1.892,0.612,4.122-0.324,4.898-2.078 C12.848,12.367,11.891,10.602,10.021,10.118" />
      </svg>
    </a>
  </li>

  <!-- GitHub -->
  <li>
    <a href="https://github.com/ketao1989" target="_blank">
      <svg width="40" height="40" class="github" version="1.1" xmlns="http://www.w3.org/2000/svg">
        <path fill="#000000" d="M28.436,15.099C27.235,14.897,25.985,14.764,24.97,14.728L24.791,14.722C24.832,14.632,24.863,14.571,24.873,14.562C24.895,14.543999999999999,24.913,14.468,24.915000000000003,14.394C24.915000000000003,14.353,24.933000000000003,14.22,24.961000000000002,14.044C25.236,14.054,25.601000000000003,14.062000000000001,25.999000000000002,14.065000000000001C27.536,14.077000000000002,29.144000000000002,14.201,30.247000000000003,14.396C30.904000000000003,14.512,31.121000000000002,14.508000000000001,30.636000000000003,14.39C30.145000000000003,14.271,28.689000000000004,14.096,27.529000000000003,14.020000000000001C26.750000000000004,13.967,25.633000000000003,13.947000000000001,24.975000000000005,13.958000000000002C24.994000000000003,13.844000000000001,25.016000000000005,13.717000000000002,25.039000000000005,13.587000000000002C25.132000000000005,13.084000000000001,25.163000000000004,12.578000000000001,25.165000000000006,11.571000000000002C25.167000000000005,10.009000000000002,25.083000000000006,9.579,24.574000000000005,8.546000000000001C24.367000000000004,8.124,24.133000000000006,7.766000000000001,23.850000000000005,7.442000000000001C24.097000000000005,6.713000000000001,24.091000000000005,5.584000000000001,23.835000000000004,4.594000000000001C23.624000000000006,3.782000000000001,23.550000000000004,3.7300000000000013,22.814000000000004,3.886000000000001C22.19,4.019,21.69,4.2,21.049,4.523C20.746,4.675999999999999,20.328,4.914,20.025,5.101C19.235,4.823,18.418,4.639,17.546,4.54C16.662,4.44,14.495,4.496,13.725999999999999,4.638C12.973999999999998,4.777,12.296999999999999,4.947,11.684,5.149C11.378,4.96,10.934,4.705,10.616999999999999,4.545C9.973,4.221,9.473,4.041,8.847,3.908C8.113,3.751,8.036999999999999,3.804,7.827,4.616C7.567,5.619,7.5649999999999995,6.7669999999999995,7.822,7.494C7.852,7.577,7.87,7.636,7.877,7.682C6.835,8.994,6.495,10.462,6.721,12.511C6.78,13.045,6.871,13.535,6.998,13.984C6.333,13.98,5.3870000000000005,14.004,4.704000000000001,14.048C3.5420000000000007,14.125,2.0860000000000007,14.298,1.5950000000000006,14.417C1.1110000000000007,14.535,1.3260000000000005,14.539,1.9840000000000007,14.424C3.0870000000000006,14.229999999999999,4.696000000000001,14.104,6.232000000000001,14.093C6.522000000000001,14.092,6.793000000000001,14.086,7.026000000000002,14.08C7.096000000000002,14.317,7.176000000000002,14.543,7.267000000000001,14.758000000000001L7.26,14.759C6.245,14.794,4.996,14.927,3.795,15.129C2.894,15.28,1.564,15.581999999999999,1.4089999999999998,15.669C1.2459999999999998,15.76,1.3789999999999998,15.74,2.077,15.563C3.3499999999999996,15.241000000000001,5.005,14.994,7.055,14.822000000000001L7.284,14.802000000000001C7.724,15.824000000000002,8.402,16.604000000000003,9.36,17.212000000000003C9.946,17.585000000000004,10.885,17.968000000000004,11.357999999999999,18.028000000000002C11.488,18.044,11.866,18.122000000000003,12.197999999999999,18.200000000000003C12.530999999999999,18.278000000000002,13.181999999999999,18.395000000000003,13.643999999999998,18.462000000000003H13.654999999999998C13.645999999999997,18.468000000000004,13.637999999999998,18.472000000000005,13.629999999999997,18.478C13.069999999999997,18.769000000000002,12.705999999999998,19.222,12.460999999999997,19.935000000000002C12.350999999999997,19.968000000000004,12.213999999999997,20.013,12.065999999999997,20.064000000000004C11.536999999999997,20.244000000000003,11.330999999999998,20.281000000000002,10.794999999999998,20.285000000000004C10.238999999999997,20.289000000000005,10.106999999999998,20.265000000000004,9.774999999999999,20.109000000000005C9.291999999999998,19.884000000000004,8.841999999999999,19.470000000000006,8.541999999999998,18.976000000000006C8.040999999999999,18.150000000000006,7.174999999999998,17.566000000000006,6.452999999999998,17.566000000000006C5.835999999999998,17.566000000000006,5.718999999999998,17.816000000000006,6.164999999999997,18.181000000000004C6.836999999999997,18.730000000000004,7.338999999999997,19.290000000000006,7.544999999999997,19.718000000000004C7.660999999999997,19.958000000000002,7.838999999999997,20.329000000000004,7.9419999999999975,20.542000000000005C8.050999999999998,20.769000000000005,8.283999999999997,21.077000000000005,8.505999999999997,21.290000000000006C9.027999999999997,21.788000000000007,9.531999999999996,22.026000000000007,10.283999999999997,22.138000000000005C10.787999999999997,22.212000000000007,10.911999999999997,22.212000000000007,11.506999999999998,22.136000000000006C11.793999999999999,22.101000000000006,12.035999999999998,22.060000000000006,12.252999999999998,22.009000000000007C12.252999999999998,22.253000000000007,12.252999999999998,22.534000000000006,12.252999999999998,22.864000000000008C12.252999999999998,24.63000000000001,12.231999999999998,25.198000000000008,12.161999999999999,25.364000000000008C12.03,25.680000000000007,11.733999999999998,26.00500000000001,11.446,26.151000000000007C11.158999999999999,26.297000000000008,11.07,26.458000000000006,11.190999999999999,26.606000000000005C11.258,26.686000000000003,11.386999999999999,26.700000000000006,11.819999999999999,26.672000000000004C12.641999999999998,26.621000000000006,13.222999999999999,26.317000000000004,13.518999999999998,25.781000000000006C13.613999999999999,25.609000000000005,13.636,25.263000000000005,13.665999999999999,23.463000000000005C13.697999999999999,21.510000000000005,13.711999999999998,21.322000000000003,13.838999999999999,21.043000000000006C13.915999999999999,20.877000000000006,14.027,20.697000000000006,14.088999999999999,20.648000000000007C14.192999999999998,20.56200000000001,14.2,20.732000000000006,14.2,23.068000000000005C14.199,25.646000000000004,14.173,25.957000000000004,13.915,26.453000000000003C13.857,26.566000000000003,13.747,26.713000000000005,13.67,26.783C13.535,26.906000000000002,13.478,27.221,13.572,27.316000000000003C13.726999999999999,27.470000000000002,14.504,27.228,14.927999999999999,26.894000000000002C15.649999999999999,26.322000000000003,15.735999999999999,25.849000000000004,15.741999999999999,22.433L15.745,20.429L15.963999999999999,20.45L16.183,20.47L16.219,23.090999999999998C16.26,26.041999999999998,16.266000000000002,26.084999999999997,16.768,26.654999999999998C17.053,26.976999999999997,17.34,27.154999999999998,17.807000000000002,27.293999999999997C18.432000000000002,27.481999999999996,18.62,27.191999999999997,18.200000000000003,26.688999999999997C17.743000000000002,26.141999999999996,17.721000000000004,25.932999999999996,17.746000000000002,22.694999999999997C17.763,20.618999999999996,17.763,20.618999999999996,17.897000000000002,20.739999999999995C18.179000000000002,20.995999999999995,18.233,21.415999999999993,18.233,23.362999999999996C18.233,25.780999999999995,18.302,26.010999999999996,19.156,26.432999999999996C19.555,26.627999999999997,19.666999999999998,26.651999999999997,20.177999999999997,26.653999999999996C20.721999999999998,26.655999999999995,20.754999999999995,26.647999999999996,20.775,26.505999999999997C20.791999999999998,26.391,20.724999999999998,26.312999999999995,20.471,26.157999999999998C20.138,25.953,19.907,25.691,19.762,25.360999999999997C19.707,25.233999999999998,19.67,24.401999999999997,19.645,22.688999999999997C19.608999999999998,20.295999999999996,19.601,20.186999999999998,19.451999999999998,19.811999999999998C19.250999999999998,19.307999999999996,18.944,18.909999999999997,18.555,18.645999999999997C18.454,18.58,18.352999999999998,18.525,18.222,18.483999999999998C18.383000000000003,18.468,18.539,18.450999999999997,18.69,18.429C20.262,18.22,21.093,18.046,21.76,17.787999999999997C23.171000000000003,17.244999999999997,24.125,16.342999999999996,24.642000000000003,15.063999999999997C24.688000000000002,14.949999999999996,24.734,14.841999999999997,24.773000000000003,14.754999999999997L25.171000000000003,14.787999999999997C27.222,14.960999999999997,28.877000000000002,15.207999999999997,30.150000000000002,15.530999999999997C30.848000000000003,15.707999999999997,30.981,15.728999999999997,30.818,15.635999999999997C30.666,15.551,29.336,15.25,28.436,15.099ZM22.422,15.068C22.189,15.58,21.539,16.238,21.014,16.496C20.496,16.752,19.683999999999997,16.947,18.764,17.04C18.134999999999998,17.104,14.626999999999999,17.122999999999998,14.047999999999998,17.066C12.130999999999998,16.878,11.056999999999999,16.509,10.264999999999999,15.77C9.514999999999999,15.068,9.165,14.115,9.225999999999999,12.942C9.264999999999999,12.208,9.441999999999998,11.747,9.905,11.187000000000001C10.325999999999999,10.677000000000001,10.769,10.362000000000002,11.290999999999999,10.202000000000002C11.727999999999998,10.068000000000001,13.068999999999999,10.056000000000001,14.871999999999998,10.172000000000002C15.668999999999999,10.223000000000003,16.328,10.223000000000003,17.124,10.172000000000002C19.009999999999998,10.053000000000003,20.269,10.066000000000003,20.733999999999998,10.210000000000003C21.465,10.436000000000003,22.130999999999997,11.044000000000002,22.531,11.854000000000003C22.711,12.216000000000003,22.746,12.370000000000003,22.772,12.929000000000002C22.808,13.699,22.675,14.517,22.422,15.068ZM12.912,11.762C11.839,11.574,11.226,13.411000000000001,12.049000000000001,14.349C12.440000000000001,14.794,12.787,14.867,13.221000000000002,14.597C13.623000000000001,14.346,13.841000000000001,13.876999999999999,13.841000000000001,13.269C13.841,12.458,13.472,11.862,12.912,11.762ZM19.425,11.872C18.352,11.684,17.738,13.519,18.561,14.458C18.953,14.903,19.299,14.977,19.734,14.705C20.135,14.455,20.354000000000003,13.985,20.354000000000003,13.377C20.354,12.569,19.985,11.971,19.425,11.872ZM16.539,15.484C16.516000000000002,15.558,16.404,15.668,16.291,15.727C16.005,15.874,15.799,15.823,15.497,15.548C15.31,15.379,15.225,15.29,15.168,15.467C15.114999999999998,15.631,15.447999999999999,15.96,15.705,16.061C15.941,16.155,16.11,16.158,16.366,16.051C16.62,15.944999999999999,16.842,15.659999999999998,16.842,15.474999999999998C16.842,15.303,16.595,15.311,16.539,15.484ZM16.222,14.909C16.385,14.765,16.422,14.469000000000001,16.266000000000002,14.312000000000001S15.793000000000001,14.179000000000002,15.669000000000002,14.355C15.525000000000002,14.561,15.602000000000002,14.718,15.705000000000002,14.885C15.865,15.009,16.08,15.034,16.222,14.909Z" />
      </svg>
    </a>
  </li>
  
</ul>
    </div>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="kxcoder.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">归档</a></li>
  <li><a href="/about">关于我</a></li>
  <li><a href="/todo">TODO</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/09/Jackson-Manual-and-Implementation-Analyzing/">Jackson 工具类使用及配置指南</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-09T22:21:35+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:21 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="section">目录</h2>

<ol>
  <li><a href="#Intro">前言</a></li>
  <li><a href="#JsonUtils">Jackson使用工具类</a></li>
  <li><a href="#JsonConfig">Jackson配置属性</a></li>
  <li><a href="#JsonParser">Jackson解析JSON数据</a></li>
  <li><a href="#JsonDeserializer">Jackson序列化Java对象</a></li>
</ol>

<h2 id="a-idintroa"><a id="Intro">前言</a></h2>

<p>Json数据格式这两年发展的很快，其声称相对XML格式有很对好处：</p>

<ul>
  <li>容易阅读；</li>
  <li>解析速度快；</li>
  <li>占用空间更少。</li>
</ul>

<p>不过，JSON 和 XML两者纠结谁优谁劣，这里不做讨论，可以参见知乎上<a href="http://www.zhihu.com/question/20738607">为什么XML这么笨重的数据结构仍在广泛应用？</a>。</p>

<p>最近在项目中，会有各种解析JSON文本的需求，使用第三方<code>Jackson</code>工具来解析时，又担心当增加会减少字段，会不会出现非预期的情况，因此，研究下<code>jackson</code>解析json数据格式的代码，很有需要。</p>

<h2 id="a-idjsonutilsjacksona"><a id="JsonUtils">Jackson使用工具类</a></h2>

<p>通常，我们对json格式的数据，只会进行解析和封装两种，也就是<code>json字符串---&gt;java对象</code>以及<code>java对象---&gt; json字符串</code>。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Jackson使用工具类 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">
</span><span class="line">    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonUtils</span> <span class="o">{</span>
</span><span class="line">    <span class="cm">/**</span>
</span><span class="line"><span class="cm">     * Logger for this class</span>
</span><span class="line"><span class="cm">     */</span>
</span><span class="line">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">JsonUtils</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">ObjectMapper</span> <span class="n">objectMapper</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ObjectMapper</span><span class="o">();</span>
</span><span class="line">
</span><span class="line">    <span class="kd">static</span> <span class="o">{</span>
</span><span class="line">        <span class="n">objectMapper</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="n">JsonParser</span><span class="o">.</span><span class="na">Feature</span><span class="o">.</span><span class="na">ALLOW_COMMENTS</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span><span class="line">        <span class="n">objectMapper</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="n">JsonParser</span><span class="o">.</span><span class="na">Feature</span><span class="o">.</span><span class="na">ALLOW_UNQUOTED_FIELD_NAMES</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span><span class="line">        <span class="n">objectMapper</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="n">JsonParser</span><span class="o">.</span><span class="na">Feature</span><span class="o">.</span><span class="na">ALLOW_SINGLE_QUOTES</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span><span class="line">        <span class="n">objectMapper</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="n">JsonParser</span><span class="o">.</span><span class="na">Feature</span><span class="o">.</span><span class="na">ALLOW_UNQUOTED_CONTROL_CHARS</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span><span class="line">        <span class="n">objectMapper</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="n">JsonParser</span><span class="o">.</span><span class="na">Feature</span><span class="o">.</span><span class="na">INTERN_FIELD_NAMES</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span><span class="line">        <span class="n">objectMapper</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="n">JsonParser</span><span class="o">.</span><span class="na">Feature</span><span class="o">.</span><span class="na">CANONICALIZE_FIELD_NAMES</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span><span class="line">        <span class="n">objectMapper</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="n">DeserializationConfig</span><span class="o">.</span><span class="na">Feature</span><span class="o">.</span><span class="na">FAIL_ON_UNKNOWN_PROPERTIES</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="kd">private</span> <span class="nf">JsonUtils</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">encode</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">        <span class="k">try</span> <span class="o">{</span>
</span><span class="line">            <span class="k">return</span> <span class="n">objectMapper</span><span class="o">.</span><span class="na">writeValueAsString</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JsonGenerationException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;encode(Object)&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span> <span class="c1">//$NON-NLS-1$</span>
</span><span class="line">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JsonMappingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;encode(Object)&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span> <span class="c1">//$NON-NLS-1$</span>
</span><span class="line">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;encode(Object)&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span> <span class="c1">//$NON-NLS-1$</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="cm">/**</span>
</span><span class="line"><span class="cm">     * 将json string反序列化成对象</span>
</span><span class="line"><span class="cm">     *</span>
</span><span class="line"><span class="cm">     * @param json</span>
</span><span class="line"><span class="cm">     * @param valueType</span>
</span><span class="line"><span class="cm">     * @return</span>
</span><span class="line"><span class="cm">     */</span>
</span><span class="line">    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">decode</span><span class="o">(</span><span class="n">String</span> <span class="n">json</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">valueType</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">        <span class="k">try</span> <span class="o">{</span>
</span><span class="line">            <span class="k">return</span> <span class="n">objectMapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="n">valueType</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JsonParseException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;decode(String, Class&lt;T&gt;)&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JsonMappingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;decode(String, Class&lt;T&gt;)&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;decode(String, Class&lt;T&gt;)&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="cm">/**</span>
</span><span class="line"><span class="cm">     * 将json array反序列化为对象</span>
</span><span class="line"><span class="cm">     *</span>
</span><span class="line"><span class="cm">     * @param json</span>
</span><span class="line"><span class="cm">     * @param jsonTypeReference</span>
</span><span class="line"><span class="cm">     * @return</span>
</span><span class="line"><span class="cm">     */</span>
</span><span class="line">    <span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">&quot;unchecked&quot;</span><span class="o">)</span>
</span><span class="line">    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">decode</span><span class="o">(</span><span class="n">String</span> <span class="n">json</span><span class="o">,</span> <span class="n">TypeReference</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">typeReference</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">        <span class="k">try</span> <span class="o">{</span>
</span><span class="line">            <span class="k">return</span> <span class="o">(</span><span class="n">T</span><span class="o">)</span> <span class="n">objectMapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="n">typeReference</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JsonParseException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;decode(String, JsonTypeReference&lt;T&gt;)&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JsonMappingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;decode(String, JsonTypeReference&lt;T&gt;)&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&quot;decode(String, JsonTypeReference&lt;T&gt;)&quot;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="a-idjsonconfigjacksona"><a id="JsonConfig">Jackson配置属性</a></h2>

<p>如果上面的工具类实例，在Jackson中存在一些属性配置，这些配置决定了最后在解析或者编码后数据视图。因此，在分析Jackson之前，先了解下，Jackson具有的一些配置含义。</p>

<h3 id="jsonparser">JsonParser解析相关配置属性</h3>

<p><code>JsonParser</code>将JSON 数据格式的String字符串，解析成为Java对象。Jackson在解析的时候，对于一些非JSON官方文档支持的属性，则需要通过一些配置才可以被Jackson工具解析成对象。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Jackson配置属性 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
<span class="line-number">138</span>
<span class="line-number">139</span>
<span class="line-number">140</span>
<span class="line-number">141</span>
<span class="line-number">142</span>
<span class="line-number">143</span>
<span class="line-number">144</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">	<span class="cm">/**</span>
</span><span class="line"><span class="cm">     * Enumeration that defines all togglable features for parsers.</span>
</span><span class="line"><span class="cm">     */</span>
</span><span class="line">    <span class="kd">public</span> <span class="kd">enum</span> <span class="n">Feature</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">        <span class="c1">// // // Low-level I/O handling features:</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 这个特性，决定了解析器是否将自动关闭那些不属于parser自己的输入源。 如果禁止，则调用应用不得不分别去关闭那些被用来创建parser的基础输入流InputStream和reader；</span>
</span><span class="line"><span class="cm">         * 如果允许，parser只要自己需要获取closed方法（当遇到输入流结束，或者parser自己调用 JsonParder#close方法），就会处理流关闭。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 注意：这个属性默认是true，即允许自动关闭流</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">AUTO_CLOSE_SOURCE</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="c1">// // // Support for non-standard data format constructs</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定parser将是否允许解析使用Java/C++ 样式的注释（包括&#39;/&#39;+&#39;*&#39; 和&#39;//&#39; 变量）。 由于JSON标准说明书上面没有提到注释是否是合法的组成，所以这是一个非标准的特性；</span>
</span><span class="line"><span class="cm">         * 尽管如此，这个特性还是被广泛地使用。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 注意：该属性默认是false，因此必须显式允许，即通过JsonParser.Feature.ALLOW_COMMENTS 配置为true。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">ALLOW_COMMENTS</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 这个特性决定parser是否将允许使用非双引号属性名字， （这种形式在Javascript中被允许，但是JSON标准说明书中没有）。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 注意：由于JSON标准上需要为属性名称使用双引号，所以这也是一个非标准特性，默认是false的。</span>
</span><span class="line"><span class="cm">         * 同样，需要设置JsonParser.Feature.ALLOW_UNQUOTED_FIELD_NAMES为true，打开该特性。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">ALLOW_UNQUOTED_FIELD_NAMES</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定parser是否允许单引号来包住属性名称和字符串值。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 注意：默认下，该属性也是关闭的。需要设置JsonParser.Feature.ALLOW_SINGLE_QUOTES为true</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">ALLOW_SINGLE_QUOTES</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定parser是否允许JSON字符串包含非引号控制字符（值小于32的ASCII字符，包含制表符和换行符）。 如果该属性关闭，则如果遇到这些字符，则会抛出异常。</span>
</span><span class="line"><span class="cm">         * JSON标准说明书要求所有控制符必须使用引号，因此这是一个非标准的特性。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 注意：默认时候，该属性关闭的。需要设置：JsonParser.Feature.ALLOW_UNQUOTED_CONTROL_CHARS为true。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">ALLOW_UNQUOTED_CONTROL_CHARS</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性可以允许接受所有引号引起来的字符，使用‘反斜杠\’机制：如果不允许，只有JSON标准说明书中 列出来的字符可以被避开约束。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 由于JSON标准说明中要求为所有控制字符使用引号，这是一个非标准的特性，所以默认是关闭的。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 注意：一般在设置ALLOW_SINGLE_QUOTES属性时，也设置了ALLOW_BACKSLASH_ESCAPING_ANY_CHARACTER属性，</span>
</span><span class="line"><span class="cm">         * 所以，有时候，你会看到不设置ALLOW_BACKSLASH_ESCAPING_ANY_CHARACTER为true，但是依然可以正常运行。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * @since 1.6</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">ALLOW_BACKSLASH_ESCAPING_ANY_CHARACTER</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定parser是否允许JSON整数以多个0开始(比如，如果000001赋值给json某变量，</span>
</span><span class="line"><span class="cm">         * 如果不设置该属性，则解析成int会抛异常报错：org.codehaus.jackson.JsonParseException: Invalid numeric value: Leading zeroes not</span>
</span><span class="line"><span class="cm">         * allowed)</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 注意：该属性默认是关闭的，如果需要打开，则设置JsonParser.Feature.ALLOW_NUMERIC_LEADING_ZEROS为true。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * @since 1.8</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">ALLOW_NUMERIC_LEADING_ZEROS</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性允许parser可以识别&quot;Not-a-Number&quot; (NaN)标识集合作为一个合法的浮点数。 例如： allows (tokens are quoted contents, not including</span>
</span><span class="line"><span class="cm">         * quotes):</span>
</span><span class="line"><span class="cm">         * &lt;ul&gt;</span>
</span><span class="line"><span class="cm">         * &lt;li&gt;&quot;INF&quot; (for positive infinity), as well as alias of &quot;Infinity&quot;</span>
</span><span class="line"><span class="cm">         * &lt;li&gt;&quot;-INF&quot; (for negative infinity), alias &quot;-Infinity&quot;</span>
</span><span class="line"><span class="cm">         * &lt;li&gt;&quot;NaN&quot; (for other not-a-numbers, like result of division by zero)</span>
</span><span class="line"><span class="cm">         * &lt;/ul&gt;</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">
</span><span class="line">        <span class="n">ALLOW_NON_NUMERIC_NUMBERS</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="c1">// // // Controlling canonicalization (interning etc)</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定JSON对象属性名称是否可以被String#intern 规范化表示。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 如果允许，则JSON所有的属性名将会 intern() ；如果不设置，则不会规范化，</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 默认下，该属性是开放的。此外，必须设置CANONICALIZE_FIELD_NAMES为true</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 关于intern方法作用：当调用 intern 方法时，如果池已经包含一个等于此 String 对象的字符串 （该对象由 equals(Object) 方法确定），则返回池中的字符串。否则，将此 String</span>
</span><span class="line"><span class="cm">         * 对象添加到池中， 并且返回此 String 对象的引用。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * @since 1.3</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">INTERN_FIELD_NAMES</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定JSON对象的属性名称是否被规范化。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * @since 1.5</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">CANONICALIZE_FIELD_NAMES</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="o">;</span>
</span><span class="line">
</span><span class="line">        <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">_defaultState</span><span class="o">;</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * Method that calculates bit set (flags) of all features that are enabled by default.</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">collectDefaults</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">            <span class="kt">int</span> <span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class="line">            <span class="k">for</span> <span class="o">(</span><span class="n">Feature</span> <span class="n">f</span> <span class="o">:</span> <span class="n">values</span><span class="o">())</span> <span class="o">{</span>
</span><span class="line">                <span class="k">if</span> <span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">enabledByDefault</span><span class="o">())</span> <span class="o">{</span>
</span><span class="line">                    <span class="n">flags</span> <span class="o">|=</span> <span class="n">f</span><span class="o">.</span><span class="na">getMask</span><span class="o">();</span>
</span><span class="line">                <span class="o">}</span>
</span><span class="line">            <span class="o">}</span>
</span><span class="line">            <span class="k">return</span> <span class="n">flags</span><span class="o">;</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">
</span><span class="line">        <span class="kd">private</span> <span class="nf">Feature</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">defaultState</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">_defaultState</span> <span class="o">=</span> <span class="n">defaultState</span><span class="o">;</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">
</span><span class="line">        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">enabledByDefault</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">            <span class="k">return</span> <span class="n">_defaultState</span><span class="o">;</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">
</span><span class="line">        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">enabledIn</span><span class="o">(</span><span class="kt">int</span> <span class="n">flags</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="k">return</span> <span class="o">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">getMask</span><span class="o">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">
</span><span class="line">        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMask</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">            <span class="k">return</span> <span class="o">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ordinal</span><span class="o">());</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<blockquote>
  <blockquote>
    <p>Note: 在枚举最后有一个公共静态方法<code>collectDefaults()</code>，这个方法返回一个整形，整形包含的是所有枚举项对应位bit为初始默认值（true：1；false：0），如果默认属性为true，则通过对<code>1 &lt;&lt; ordinal()</code>的值和flags进行亦或来置位。</p>
  </blockquote>
</blockquote>

<h3 id="deserializationconfig">DeserializationConfig反序列化相关配置属性</h3>

<p>将Java 对象序列化为Json字符串。Jackson在序列化Java对象的时候，对于有些不存在的属性处理，以及一些类型转换等，都可以通过配置来设置。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Jackson反序列配置 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
<span class="line-number">138</span>
<span class="line-number">139</span>
<span class="line-number">140</span>
<span class="line-number">141</span>
<span class="line-number">142</span>
<span class="line-number">143</span>
<span class="line-number">144</span>
<span class="line-number">145</span>
<span class="line-number">146</span>
<span class="line-number">147</span>
<span class="line-number">148</span>
<span class="line-number">149</span>
<span class="line-number">150</span>
<span class="line-number">151</span>
<span class="line-number">152</span>
<span class="line-number">153</span>
<span class="line-number">154</span>
<span class="line-number">155</span>
<span class="line-number">156</span>
<span class="line-number">157</span>
<span class="line-number">158</span>
<span class="line-number">159</span>
<span class="line-number">160</span>
<span class="line-number">161</span>
<span class="line-number">162</span>
<span class="line-number">163</span>
<span class="line-number">164</span>
<span class="line-number">165</span>
<span class="line-number">166</span>
<span class="line-number">167</span>
<span class="line-number">168</span>
<span class="line-number">169</span>
<span class="line-number">170</span>
<span class="line-number">171</span>
<span class="line-number">172</span>
<span class="line-number">173</span>
<span class="line-number">174</span>
<span class="line-number">175</span>
<span class="line-number">176</span>
<span class="line-number">177</span>
<span class="line-number">178</span>
<span class="line-number">179</span>
<span class="line-number">180</span>
<span class="line-number">181</span>
<span class="line-number">182</span>
<span class="line-number">183</span>
<span class="line-number">184</span>
<span class="line-number">185</span>
<span class="line-number">186</span>
<span class="line-number">187</span>
<span class="line-number">188</span>
<span class="line-number">189</span>
<span class="line-number">190</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">	<span class="cm">/**</span>
</span><span class="line"><span class="cm">     * Enumeration that defines togglable features that guide the serialization feature.</span>
</span><span class="line"><span class="cm">     */</span>
</span><span class="line">    <span class="kd">public</span> <span class="kd">enum</span> <span class="n">Feature</span> <span class="kd">implements</span> <span class="n">MapperConfig</span><span class="o">.</span><span class="na">ConfigFeature</span> <span class="o">{</span>
</span><span class="line">        <span class="cm">/*</span>
</span><span class="line"><span class="cm">         * /****************************************************** Introspection features</span>
</span><span class="line"><span class="cm">         * /******************************************************</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定是否启动内部注解功能支持配置；如果允许，则使用AnnotationIntrospector扫描配置，否则，不考了注解配置。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 默认启动该功能配置属性。</span>
</span><span class="line"><span class="cm">         * </span>
</span><span class="line"><span class="cm">         * @since 1.2</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">USE_ANNOTATIONS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定是否使用“getter”方法来根据标准bean命名转换方式来自动检测。如果true，则所有公共的带有一个参数</span>
</span><span class="line"><span class="cm">         * 并且前缀为set的方法都将被当做setter方法。如果false，只会把显式注解的作为setter方法。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 注意: 这个特性的优先级低于显式注解，并且只会在获取不到更细粒度配置的情况下。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">AUTO_DETECT_GETTERS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>                        <span class="n">DETECT_IS_GETTERS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定是否使用creator方法来根据公共构造函数以及名字为“valueOf”的静态单参数方法自动检测。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 注意：这个特性比每个类上注解的优先级要低。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">AUTO_DETECT_CREATORS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 这个特性决定是否非静态field被当做属性。如果true，则所有公共成员field都被当做属性， 否则只有注解，才会被当做属性field。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">AUTO_DETECT_FIELDS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 使用getter方法来作为setter方法（一般只处理集合和Maps，和其他没有setter的类型）。 该属性决定是否不需要setter方法，而只需要getter方法来修改属性。</span>
</span><span class="line"><span class="cm">         * </span>
</span><span class="line"><span class="cm">         * 注意：该配置优先级低于setter。</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">USE_GETTERS_AS_SETTERS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定当访问属性时候，方法和field访问是否修改设置。 如果设置为true，则通过反射调用方法AccessibleObject#setAccessible 来允许访问不能访问的对象。</span>
</span><span class="line"><span class="cm">         * </span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">CAN_OVERRIDE_ACCESS_MODIFIERS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>                <span class="n">GETTERS</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/*</span>
</span><span class="line"><span class="cm">         * /****************************************************** /* Type conversion features</span>
</span><span class="line"><span class="cm">         * /******************************************************</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定对于json浮点数，是否使用BigDecimal来序列化。如果不允许，则使用Double序列化。</span>
</span><span class="line"><span class="cm">         * </span>
</span><span class="line"><span class="cm">         * 注意：该特性默认是关闭的，因为性能上来说，BigDecimal低于Double。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">USE_BIG_DECIMAL_FOR_FLOATS</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定对于json整形（非浮点），是否使用BigInteger来序列化。如果不允许，则根据数值大小来确定 是使用Integer}, {@link Long} 或者</span>
</span><span class="line"><span class="cm">         * {@link java.math.BigInteger}</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">USE_BIG_INTEGER_FOR_INTS</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="c1">// [JACKSON-652]</span>
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定JSON ARRAY是映射为Object[]还是List&lt;Object&gt;。如果开启，都为Object[]，false时，则使用List。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * @since 1.9</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">USE_JAVA_ARRAY_FOR_JSON_ARRAY</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定了使用枚举值的标准序列化机制：如果允许，则枚举假定使用Enum.toString()返回的值作为序列化结构；如果禁止, 则返回Enum.name()的值。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 注意：默认使用的时Enum.name()的值作为枚举序列化结果。这个的设置和WRITE_ENUMS_USING_TO_STRING需要一致。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * For further details, check out [JACKSON-212]</span>
</span><span class="line"><span class="cm">         * </span>
</span><span class="line"><span class="cm">         * @since 1.6</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">READ_ENUMS_USING_TO_STRING</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/*</span>
</span><span class="line"><span class="cm">         * /****************************************************** Error handling features</span>
</span><span class="line"><span class="cm">         * /****************************************************** 错误处理特性</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定了当遇到未知属性（没有映射到属性，没有任何setter或者任何可以处理它的handler），是否应该抛出一个</span>
</span><span class="line"><span class="cm">         * JsonMappingException异常。这个特性一般式所有其他处理方法对未知属性处理都无效后才被尝试，属性保留未处理状态。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 默认情况下，该设置是被打开的。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * @since 1.2</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">FAIL_ON_UNKNOWN_PROPERTIES</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定当遇到JSON null的对象是java 原始类型，则是否抛出异常。当false时，则使用0 for &#39;int&#39;, 0.0 for double 来设定原始对象初始值。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * 默认情况下，允许原始类型可以使用null。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * @since 1.7</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">FAIL_ON_NULL_FOR_PRIMITIVES</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定JSON 整数是否是一个有效的值，当被用来反序列化Java枚举值。如果false，数字可以接受，并且映射为枚举的值ordinal()；</span>
</span><span class="line"><span class="cm">         * 如果true，则数字不允许并且抛出JsonMappingException异常。后面一种行为原因是因为大部分情况下，枚举被反序列化为 JSON 字符串， 从而造成从整形到枚举的意外映射关系。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * Feature is disabled by default (to be consistent with behavior of Jackson 1.6), i.e. to allow use of JSON</span>
</span><span class="line"><span class="cm">         * integers for Java enums.</span>
</span><span class="line"><span class="cm">         * </span>
</span><span class="line"><span class="cm">         * @since 1.7</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">FAIL_ON_NUMBERS_FOR_ENUMS</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 异常封装，不封装Error,catch异常之后，抛出IOException。默认封装异常。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * @since 1.7</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">WRAP_EXCEPTIONS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/*</span>
</span><span class="line"><span class="cm">         * /****************************************************** Structural conversion features</span>
</span><span class="line"><span class="cm">         * /****************************************************** 数据结构转换特性</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定是否接受强制非数组（JSON）值到Java集合类型。如果允许，集合反序列化将尝试处理非数组值。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * Feature that determines whether it is acceptable to coerce non-array (in JSON) values to work with Java</span>
</span><span class="line"><span class="cm">         * collection (arrays, java.util.Collection) types. If enabled, collection deserializers will try to handle</span>
</span><span class="line"><span class="cm">         * non-array values as if they had &quot;implicit&quot; surrounding JSON array. This feature is meant to be used for</span>
</span><span class="line"><span class="cm">         * compatibility/interoperability reasons, to work with packages (such as XML-to-JSON converters) that leave out</span>
</span><span class="line"><span class="cm">         * JSON array in cases where there is just a single element in array.</span>
</span><span class="line"><span class="cm">         * </span>
</span><span class="line"><span class="cm">         * @since 1.8</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">ACCEPT_SINGLE_VALUE_AS_ARRAY</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特征允许 unwrap根级别JSON 值，来匹配WRAP_ROOT_VALUE 序列化设置。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * @since 1.9</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">UNWRAP_ROOT_VALUE</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/*</span>
</span><span class="line"><span class="cm">         * /****************************************************** Value conversion features</span>
</span><span class="line"><span class="cm">         * /****************************************************** 值转换特性</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性可以允许JSON空字符串转换为POJO对象为null。如果禁用，则标准POJO只会从JSON null或者JSON对象转换过来；</span>
</span><span class="line"><span class="cm">         * 如果允许，则空JSON字符串可以等价于JSON null。</span>
</span><span class="line"><span class="cm">         * @since 1.8</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">ACCEPT_EMPTY_STRING_AS_NULL_OBJECT</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">        <span class="o">;</span>
</span><span class="line">
</span><span class="line">        <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">_defaultState</span><span class="o">;</span>
</span><span class="line">
</span><span class="line">        <span class="kd">private</span> <span class="nf">Feature</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">defaultState</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">_defaultState</span> <span class="o">=</span> <span class="n">defaultState</span><span class="o">;</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">enabledByDefault</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">            <span class="k">return</span> <span class="n">_defaultState</span><span class="o">;</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMask</span><span class="o">()</span> <span class="o">{</span>
</span><span class="line">            <span class="k">return</span> <span class="o">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ordinal</span><span class="o">());</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="serializationconfig-">SerializationConfig 序列化相关配置属性</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Jackson序列化配置 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
<span class="line-number">138</span>
<span class="line-number">139</span>
<span class="line-number">140</span>
<span class="line-number">141</span>
<span class="line-number">142</span>
<span class="line-number">143</span>
<span class="line-number">144</span>
<span class="line-number">145</span>
<span class="line-number">146</span>
<span class="line-number">147</span>
<span class="line-number">148</span>
<span class="line-number">149</span>
<span class="line-number">150</span>
<span class="line-number">151</span>
<span class="line-number">152</span>
<span class="line-number">153</span>
<span class="line-number">154</span>
<span class="line-number">155</span>
<span class="line-number">156</span>
<span class="line-number">157</span>
<span class="line-number">158</span>
<span class="line-number">159</span>
<span class="line-number">160</span>
<span class="line-number">161</span>
<span class="line-number">162</span>
<span class="line-number">163</span>
<span class="line-number">164</span>
<span class="line-number">165</span>
<span class="line-number">166</span>
<span class="line-number">167</span>
<span class="line-number">168</span>
<span class="line-number">169</span>
<span class="line-number">170</span>
<span class="line-number">171</span>
<span class="line-number">172</span>
<span class="line-number">173</span>
<span class="line-number">174</span>
<span class="line-number">175</span>
<span class="line-number">176</span>
<span class="line-number">177</span>
<span class="line-number">178</span>
<span class="line-number">179</span>
<span class="line-number">180</span>
<span class="line-number">181</span>
<span class="line-number">182</span>
<span class="line-number">183</span>
<span class="line-number">184</span>
<span class="line-number">185</span>
<span class="line-number">186</span>
<span class="line-number">187</span>
<span class="line-number">188</span>
<span class="line-number">189</span>
<span class="line-number">190</span>
<span class="line-number">191</span>
<span class="line-number">192</span>
<span class="line-number">193</span>
<span class="line-number">194</span>
<span class="line-number">195</span>
<span class="line-number">196</span>
<span class="line-number">197</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">	<span class="cm">/**</span>
</span><span class="line"><span class="cm">     * 定义序列化对象所需配置的一些枚举.</span>
</span><span class="line"><span class="cm">     */</span>
</span><span class="line">    <span class="kd">public</span> <span class="kd">enum</span> <span class="n">Feature</span> <span class="kd">implements</span> <span class="n">MapperConfig</span><span class="o">.</span><span class="na">ConfigFeature</span>
</span><span class="line">    <span class="o">{</span>
</span><span class="line">        <span class="cm">/*</span>
</span><span class="line"><span class="cm">        /******************************************************</span>
</span><span class="line"><span class="cm">        /*  Introspection features</span>
</span><span class="line"><span class="cm">        /******************************************************</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 注解扫描配置</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">USE_ANNOTATIONS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 获取getter方法，前缀为get</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">AUTO_DETECT_GETTERS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 获取getter方法，前缀为is</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">AUTO_DETECT_IS_GETTERS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 将对象所有的field作为json属性</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">         <span class="n">AUTO_DETECT_FIELDS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定当访问属性时候，方法和field访问是否修改设置。 如果设置为true，</span>
</span><span class="line"><span class="cm">         * 则通过反射调用方法AccessibleObject#setAccessible 来允许访问不能访问的对象。</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">CAN_OVERRIDE_ACCESS_MODIFIERS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 获取的getter方法需要setter方法，否则，所有发现的getter都可以作为getter方法。</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">REQUIRE_SETTERS_FOR_GETTERS</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/*</span>
</span><span class="line"><span class="cm">        /******************************************************</span>
</span><span class="line"><span class="cm">        /* Generic output features</span>
</span><span class="line"><span class="cm">        /******************************************************</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 属性对应的值为null，是否需要写出来，write out。</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="nd">@Deprecated</span>
</span><span class="line">        <span class="n">WRITE_NULL_PROPERTIES</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 特征决定是使用运行时动态类型，还是声明的静态类型。</span>
</span><span class="line"><span class="cm">         * 也可以使用{@link JsonSerialize#typing} 注解属性</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">USE_STATIC_TYPING</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定拥有view注解{@link org.codehaus.jackson.map.annotate.JsonView}的属性是否在JSON序列化视图中。如果true，则非注解视图，也包含；</span>
</span><span class="line"><span class="cm">         * 否则，它们将会被排除在外。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">DEFAULT_VIEW_INCLUSION</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 在JAVA中配置XML root{@XmlRootElement.name}注解,最后xml数据中会出现对应root根name.</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">WRAP_ROOT_VALUE</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性对于最基础的生成器，使用默认pretty printer {@link org.codehaus.jackson.JsonGenerator#useDefaultPrettyPrinter}</span>
</span><span class="line"><span class="cm">         * 这只会对{@link org.codehaus.jackson.JsonGenerator}有影响.该属性值允许使用默认的实现。</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">INDENT_OUTPUT</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 是否对属性使用排序，默认排序按照字母顺序。</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">SORT_PROPERTIES_ALPHABETICALLY</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/*</span>
</span><span class="line"><span class="cm">        /******************************************************</span>
</span><span class="line"><span class="cm">        /*  Error handling features</span>
</span><span class="line"><span class="cm">        /******************************************************</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 是否允许一个类型没有注解表明打算被序列化。默认true，抛出一个异常；否则序列化一个空对象，比如没有任何属性。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * Note that empty types that this feature has only effect on</span>
</span><span class="line"><span class="cm">         * those &quot;empty&quot; beans that do not have any recognized annotations</span>
</span><span class="line"><span class="cm">         * (like &lt;code&gt;@JsonSerialize&lt;/code&gt;): ones that do have annotations</span>
</span><span class="line"><span class="cm">         * do not result in an exception being thrown.</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * @since 1.4</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">FAIL_ON_EMPTY_BEANS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 封装所有异常</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">WRAP_EXCEPTIONS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/*</span>
</span><span class="line"><span class="cm">        /******************************************************</span>
</span><span class="line"><span class="cm">        /* Output life cycle features</span>
</span><span class="line"><span class="cm">        /******************************************************</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">
</span><span class="line">         <span class="cm">/**</span>
</span><span class="line"><span class="cm">          * 该特性决定序列化root级对象的实现closeable接口的close方法是否在序列化后被调用。</span>
</span><span class="line"><span class="cm">          * </span>
</span><span class="line"><span class="cm">          * 注意：如果true，则完成序列化后就关闭；如果，你可以在处理最后，调用排序操作等，则为false。</span>
</span><span class="line"><span class="cm">          * </span>
</span><span class="line"><span class="cm">          */</span>
</span><span class="line">        <span class="n">CLOSE_CLOSEABLE</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定是否在writeValue()方法之后就调用JsonGenerator.flush()方法。</span>
</span><span class="line"><span class="cm">         * 当我们需要先压缩，然后再flush，则可能需要false。</span>
</span><span class="line"><span class="cm">         * </span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">FLUSH_AFTER_WRITE_VALUE</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/*</span>
</span><span class="line"><span class="cm">        /******************************************************</span>
</span><span class="line"><span class="cm">        /* Data type - specific serialization configuration</span>
</span><span class="line"><span class="cm">        /******************************************************</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定是否将基于Date的值序列化为timestamp数字式的值，或者作为文本表示。</span>
</span><span class="line"><span class="cm">         * 如果文本表示，则实际格式化的时候会调用{@link #getDateFormat}方法。</span>
</span><span class="line"><span class="cm">         * </span>
</span><span class="line"><span class="cm">         * 该特性可能会影响其他date相关类型的处理，虽然我们理想情况是只对date起作用。</span>
</span><span class="line"><span class="cm">         * </span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">WRITE_DATES_AS_TIMESTAMPS</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 是否将Map中得key为Date的值，也序列化为timestamps形式（否则，会被序列化为文本形式的值）。</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">WRITE_DATE_KEYS_AS_TIMESTAMPS</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定怎样处理类型char[]序列化，是否序列化为一个显式的JSON数组，还是默认作为一个字符串。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">WRITE_CHAR_ARRAYS_AS_JSON_ARRAYS</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 该特性决定对Enum 枚举值使用标准的序列化机制。如果true，则返回Enum.toString()值，否则为Enum.name()</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">WRITE_ENUMS_USING_TO_STRING</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 这个特性决定Java枚举值是否序列化为数字（true）或者文本值（false）.如果是值的话，则使用Enum.ordinal().</span>
</span><span class="line"><span class="cm">         * 该特性优先级高于上面的那个。</span>
</span><span class="line"><span class="cm">         * </span>
</span><span class="line"><span class="cm">         * @since 1.9</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">WRITE_ENUMS_USING_INDEX</span><span class="o">(</span><span class="kc">false</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 决定是否Map的带有null值的entry被序列化（true）</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">WRITE_NULL_MAP_VALUES</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
</span><span class="line">
</span><span class="line">        <span class="cm">/**</span>
</span><span class="line"><span class="cm">         * 决定容器空的属性（声明为Collection或者array的值）是否被序列化为空的JSON数组（true），否则强制输出。</span>
</span><span class="line"><span class="cm">         *</span>
</span><span class="line"><span class="cm">         * Note that this does not change behavior of {@link java.util.Map}s, or</span>
</span><span class="line"><span class="cm">         * &quot;Collection-like&quot; types.</span>
</span><span class="line"><span class="cm">         * </span>
</span><span class="line"><span class="cm">         * @since 1.9</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">WRITE_EMPTY_JSON_ARRAYS</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">            <span class="o">;</span>
</span><span class="line">
</span><span class="line">        <span class="kd">final</span> <span class="kt">boolean</span> <span class="n">_defaultState</span><span class="o">;</span>
</span><span class="line">
</span><span class="line">        <span class="kd">private</span> <span class="nf">Feature</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">defaultState</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">_defaultState</span> <span class="o">=</span> <span class="n">defaultState</span><span class="o">;</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">enabledByDefault</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">_defaultState</span><span class="o">;</span> <span class="o">}</span>
</span><span class="line">
</span><span class="line">        <span class="nd">@Override</span>
</span><span class="line">        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getMask</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="o">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ordinal</span><span class="o">());</span> <span class="o">}</span>
</span><span class="line">    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="a-idjsonparserjacksonjsona"><a id="JsonParser">Jackson解析JSON数据</a></h2>

<p>Jackson对外提供了多种解析json数据格式的方法，例如，<code>String context</code>、<code>Reader src</code>、<code>Url src</code>等，此外，对于Java POJO类型也提供了三种方式：<code>Class&lt;T&gt; valueType</code>和<code>TypeReference valueTypeRef</code>以及<code>JavaType valueType</code>。为了简单，这里分析通常应用最多的一种，即</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Jackson解析JSON数据 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">readValue</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">valueType</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><code>readValue()</code>和其他解析方法一样，内部都是通过构造<code>_readMapAndClose(JsonParser jp, JavaType valueType)</code>方法所需要的参数，来调用解析JSON数据的。</p>

<p>首先，来看下如何构造方法的两个参数：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Jackson解析JSON数据 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">	<span class="kd">public</span> <span class="n">JsonParser</span> <span class="nf">createJsonParser</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">)</span>
</span><span class="line">        <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonParseException</span>
</span><span class="line">    <span class="o">{</span>
</span><span class="line">	<span class="c1">// true -&gt; we own the Reader (and must close); not a big deal（还记得上面的配置吗:)）</span>
</span><span class="line">	<span class="n">Reader</span> <span class="n">r</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StringReader</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
</span><span class="line">	<span class="k">return</span> <span class="nf">_createJsonParser</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="n">_createContext</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="kc">true</span><span class="o">));</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="c1">// 构造实际使用的parser的工厂方法。</span>
</span><span class="line">    <span class="c1">// _parserFeatures就是上面默认的属性int，collectDefaults()方法返回值。</span>
</span><span class="line">    <span class="c1">// _objectCodec：实现在JAVA对象和JSON内容之间的转换功能，没有默认，需要显式去设置。一般我们直接使用MappingJsonFactory构造。</span>
</span><span class="line">    <span class="kd">protected</span> <span class="n">JsonParser</span> <span class="nf">_createJsonParser</span><span class="o">(</span><span class="n">Reader</span> <span class="n">r</span><span class="o">,</span> <span class="n">IOContext</span> <span class="n">ctxt</span><span class="o">)</span>
</span><span class="line">	<span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonParseException</span>
</span><span class="line">    <span class="o">{</span>
</span><span class="line">        <span class="k">return</span> <span class="k">new</span> <span class="nf">ReaderBasedParser</span><span class="o">(</span><span class="n">ctxt</span><span class="o">,</span> <span class="n">_parserFeatures</span><span class="o">,</span> <span class="n">r</span><span class="o">,</span> <span class="n">_objectCodec</span><span class="o">,</span>
</span><span class="line">                <span class="n">_rootCharSymbols</span><span class="o">.</span><span class="na">makeChild</span><span class="o">(</span><span class="n">isEnabled</span><span class="o">(</span><span class="n">JsonParser</span><span class="o">.</span><span class="na">Feature</span><span class="o">.</span><span class="na">CANONICALIZE_FIELD_NAMES</span><span class="o">),</span>
</span><span class="line">                    <span class="n">isEnabled</span><span class="o">(</span><span class="n">JsonParser</span><span class="o">.</span><span class="na">Feature</span><span class="o">.</span><span class="na">INTERN_FIELD_NAMES</span><span class="o">)));</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="c1">// 直接调用构造函数构造一个JsonParser实现类实例</span>
</span><span class="line">    <span class="kd">public</span> <span class="nf">ReaderBasedParser</span><span class="o">(</span><span class="n">IOContext</span> <span class="n">ioCtxt</span><span class="o">,</span> <span class="kt">int</span> <span class="n">features</span><span class="o">,</span> <span class="n">Reader</span> <span class="n">r</span><span class="o">,</span>
</span><span class="line">                             <span class="n">ObjectCodec</span> <span class="n">codec</span><span class="o">,</span> <span class="n">CharsToNameCanonicalizer</span> <span class="n">st</span><span class="o">)</span>
</span><span class="line">    <span class="o">{</span>
</span><span class="line">        <span class="kd">super</span><span class="o">(</span><span class="n">ioCtxt</span><span class="o">,</span> <span class="n">features</span><span class="o">,</span> <span class="n">r</span><span class="o">);</span>
</span><span class="line">        <span class="n">_objectCodec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">;</span>
</span><span class="line">        <span class="n">_symbols</span> <span class="o">=</span> <span class="n">st</span><span class="o">;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>在上面实现中，还可以看看<code>_createContext(r, true)</code>的实现，它会构造出一个<code>IOConetxt</code>对象。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Jackson解析JSON数据 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">	<span class="kd">public</span> <span class="nf">IOContext</span><span class="o">(</span><span class="n">BufferRecycler</span> <span class="n">br</span><span class="o">,</span> <span class="n">Object</span> <span class="n">sourceRef</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">managedResource</span><span class="o">)</span>
</span><span class="line">    <span class="o">{</span>
</span><span class="line">        <span class="n">_bufferRecycler</span> <span class="o">=</span> <span class="n">br</span><span class="o">;</span>
</span><span class="line">        <span class="n">_sourceRef</span> <span class="o">=</span> <span class="n">sourceRef</span><span class="o">;</span>
</span><span class="line">        <span class="n">_managedResource</span> <span class="o">=</span> <span class="n">managedResource</span><span class="o">;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="c1">//  _recyclerRef 是一个定义全局的ThreadLocal&lt;SoftReference&lt;BufferRecycler&gt;&gt;</span>
</span><span class="line">     <span class="kd">public</span> <span class="n">BufferRecycler</span> <span class="nf">_getBufferRecycler</span><span class="o">()</span>
</span><span class="line">    <span class="o">{</span>
</span><span class="line">        <span class="n">SoftReference</span><span class="o">&lt;</span><span class="n">BufferRecycler</span><span class="o">&gt;</span> <span class="n">ref</span> <span class="o">=</span> <span class="n">_recyclerRef</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span><span class="line">        <span class="n">BufferRecycler</span> <span class="n">br</span> <span class="o">=</span> <span class="o">(</span><span class="n">ref</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">ref</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span><span class="line">
</span><span class="line">        <span class="k">if</span> <span class="o">(</span><span class="n">br</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">BufferRecycler</span><span class="o">();</span>
</span><span class="line">            <span class="n">_recyclerRef</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="k">new</span> <span class="n">SoftReference</span><span class="o">&lt;</span><span class="n">BufferRecycler</span><span class="o">&gt;(</span><span class="n">br</span><span class="o">));</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="k">return</span> <span class="n">br</span><span class="o">;</span>
</span><span class="line">    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>构造函数有三个参数，<code>managedResource</code>，我们在配置上讲过，Jackson对于外部的资源会默认自动关闭流，但是对<code>自己拥有的流Reader</code>，会自动关闭，无论设置与否。<code>Object sourceRef</code>参数其实就是我们通过<code>content</code>构造出来的Reader引用。<code>BufferRecycler br</code>这是一个很重要的参数，涉及到内存分配优化。</p>

<blockquote>
  <blockquote>
    <p>Note： <code>BufferRecycler</code>其实就是一个小的工具类，主要负责初始字节/字符缓存的重复使用。在Jackson中，主要用来通过引用该类的<code>SoftReference</code>形式作为<code>ThreadLocal</code>成员，这样可以达到低负载GC循环的效果，显然是使用流reader所期待的结果。
其主要定义四种类型缓存：</p>
  </blockquote>
</blockquote>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Jackson解析JSON数据 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">      <span class="kd">public</span> <span class="kd">enum</span> <span class="n">CharBufferType</span> <span class="o">{</span>
</span><span class="line">        <span class="n">TOKEN_BUFFER</span><span class="o">(</span><span class="mi">2000</span><span class="o">)</span> <span class="c1">// Tokenizable input</span>
</span><span class="line">            <span class="o">,</span><span class="n">CONCAT_BUFFER</span><span class="o">(</span><span class="mi">2000</span><span class="o">)</span> <span class="c1">// concatenated output</span>
</span><span class="line">            <span class="o">,</span><span class="n">TEXT_BUFFER</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span> <span class="c1">// Text content from input</span>
</span><span class="line">            <span class="o">,</span><span class="n">NAME_COPY_BUFFER</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span> <span class="c1">// Temporary buffer for getting name characters</span>
</span><span class="line">            <span class="o">;</span>
</span><span class="line">
</span><span class="line"> <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
</span><span class="line">
</span><span class="line"> <span class="n">CharBufferType</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">size</span> <span class="o">=</span> <span class="n">size</span><span class="o">;</span> <span class="o">}</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>上面的<code>JsonParser</code>就完成的参数构造，接下来就是<code>JavaType</code>了，两种类型都最后调用<code>_constructType</code>来构造<code>JavaType</code>类型。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Jackson解析JSON数据 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">	<span class="kd">public</span> <span class="n">JavaType</span> <span class="nf">constructType</span><span class="o">(</span><span class="n">Type</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">        <span class="k">return</span> <span class="nf">_constructType</span><span class="o">(</span><span class="n">type</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">
</span><span class="line">    <span class="cm">/**</span>
</span><span class="line"><span class="cm">     * Factory method that can be used if type information is passed</span>
</span><span class="line"><span class="cm">     * as Java typing returned from &lt;code&gt;getGenericXxx&lt;/code&gt; methods</span>
</span><span class="line"><span class="cm">     * (usually for a return or argument type).</span>
</span><span class="line"><span class="cm">     */</span>
</span><span class="line">    <span class="kd">public</span> <span class="n">JavaType</span> <span class="nf">_constructType</span><span class="o">(</span><span class="n">Type</span> <span class="n">type</span><span class="o">,</span> <span class="n">TypeBindings</span> <span class="n">context</span><span class="o">)</span>
</span><span class="line">    <span class="o">{</span>
</span><span class="line">        <span class="n">JavaType</span> <span class="n">resultType</span><span class="o">;</span>
</span><span class="line">
</span><span class="line">        <span class="c1">// simple class?</span>
</span><span class="line">        <span class="k">if</span> <span class="o">(</span><span class="n">type</span> <span class="k">instanceof</span> <span class="n">Class</span><span class="o">&lt;?&gt;)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cls</span> <span class="o">=</span> <span class="o">(</span><span class="n">Class</span><span class="o">&lt;?&gt;)</span> <span class="n">type</span><span class="o">;</span>
</span><span class="line">            <span class="cm">/* 24-Mar-2010, tatu: Better create context if one was not passed;</span>
</span><span class="line"><span class="cm">             *   mostly matters for root serialization types</span>
</span><span class="line"><span class="cm">             */</span>
</span><span class="line">            <span class="k">if</span> <span class="o">(</span><span class="n">context</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                <span class="n">context</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">TypeBindings</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">cls</span><span class="o">);</span>
</span><span class="line">            <span class="o">}</span>
</span><span class="line">            <span class="n">resultType</span> <span class="o">=</span> <span class="n">_fromClass</span><span class="o">(</span><span class="n">cls</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="c1">// But if not, need to start resolving.</span>
</span><span class="line">        <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">type</span> <span class="k">instanceof</span> <span class="n">ParameterizedType</span><span class="o">)</span> <span class="o">{</span><span class="c1">//带有参数化的类型，比如Collection&lt;String&gt;</span>
</span><span class="line">            <span class="n">resultType</span> <span class="o">=</span> <span class="n">_fromParamType</span><span class="o">((</span><span class="n">ParameterizedType</span><span class="o">)</span> <span class="n">type</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">type</span> <span class="k">instanceof</span> <span class="n">GenericArrayType</span><span class="o">)</span> <span class="o">{</span><span class="c1">//表示一个数组类型，成员有参数化类型或者type变量</span>
</span><span class="line">            <span class="n">resultType</span> <span class="o">=</span> <span class="n">_fromArrayType</span><span class="o">((</span><span class="n">GenericArrayType</span><span class="o">)</span> <span class="n">type</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">type</span> <span class="k">instanceof</span> <span class="n">TypeVariable</span><span class="o">&lt;?&gt;)</span> <span class="o">{</span><span class="c1">//其他类型的父接口</span>
</span><span class="line">            <span class="n">resultType</span> <span class="o">=</span> <span class="n">_fromVariable</span><span class="o">((</span><span class="n">TypeVariable</span><span class="o">&lt;?&gt;)</span> <span class="n">type</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">type</span> <span class="k">instanceof</span> <span class="n">WildcardType</span><span class="o">)</span> <span class="o">{</span><span class="c1">//通配符类型，比如? 或者 ? extends Number</span>
</span><span class="line">            <span class="n">resultType</span> <span class="o">=</span> <span class="n">_fromWildcard</span><span class="o">((</span><span class="n">WildcardType</span><span class="o">)</span> <span class="n">type</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">        <span class="c1">// 最后类型都不符合，就会抛出非法参数异常Unrecognized Type</span>
</span><span class="line">          <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">&quot;Unrecognized Type: &quot;</span><span class="o">+</span><span class="n">type</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="cm">/* </span>
</span><span class="line"><span class="cm">         * 目前只会被 simple types调用 (i.e. not for arrays, map or collections).</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="k">if</span> <span class="o">(</span><span class="n">_modifiers</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">resultType</span><span class="o">.</span><span class="na">isContainerType</span><span class="o">())</span> <span class="o">{</span>
</span><span class="line">            <span class="k">for</span> <span class="o">(</span><span class="n">TypeModifier</span> <span class="n">mod</span> <span class="o">:</span> <span class="n">_modifiers</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                <span class="n">resultType</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="na">modifyType</span><span class="o">(</span><span class="n">resultType</span><span class="o">,</span> <span class="n">type</span><span class="o">,</span> <span class="n">context</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
</span><span class="line">            <span class="o">}</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="k">return</span> <span class="n">resultType</span><span class="o">;</span>
</span><span class="line">    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<blockquote>
  <blockquote>
    <p>代码逻辑很简单，就是通过对参数类型进行不同的处理构造，最后返回<code>JavaType</code>某一具体的实现类实例。和其他处理一样，一般都是从精确类型开始匹配，慢慢抽象。</p>
  </blockquote>
</blockquote>

<p>接下来，为了简单起见，我们不对非常用设置进行分析，看下面代码：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Jackson解析JSON数据 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">	<span class="kd">protected</span> <span class="n">Object</span> <span class="nf">_readMapAndClose</span><span class="o">(</span><span class="n">JsonParser</span> <span class="n">jp</span><span class="o">,</span> <span class="n">JavaType</span> <span class="n">valueType</span><span class="o">)</span>
</span><span class="line">        <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonParseException</span><span class="o">,</span> <span class="n">JsonMappingException</span>
</span><span class="line">    <span class="o">{</span>
</span><span class="line">        <span class="k">try</span> <span class="o">{</span>
</span><span class="line">            <span class="n">Object</span> <span class="n">result</span><span class="o">;</span>
</span><span class="line">            <span class="n">JsonToken</span> <span class="n">t</span> <span class="o">=</span> <span class="n">_initForReading</span><span class="o">(</span><span class="n">jp</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">            <span class="c1">// 省略一部分非重点代码。。。。。。</span>
</span><span class="line">
</span><span class="line">            	<span class="n">DeserializationConfig</span> <span class="n">cfg</span> <span class="o">=</span> <span class="n">copyDeserializationConfig</span><span class="o">();</span><span class="c1">//创建一个反序列化配置的副本，内部采用copy-on-write模式，所以使用副本。</span>
</span><span class="line">                <span class="n">DeserializationContext</span> <span class="n">ctxt</span> <span class="o">=</span> <span class="n">_createDeserializationContext</span><span class="o">(</span><span class="n">jp</span><span class="o">,</span> <span class="n">cfg</span><span class="o">);</span><span class="c1">//反序列化上下文</span>
</span><span class="line">                <span class="n">JsonDeserializer</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">deser</span> <span class="o">=</span> <span class="n">_findRootDeserializer</span><span class="o">(</span><span class="n">cfg</span><span class="o">,</span> <span class="n">valueType</span><span class="o">);</span>
</span><span class="line">                <span class="k">if</span> <span class="o">(</span><span class="n">cfg</span><span class="o">.</span><span class="na">isEnabled</span><span class="o">(</span><span class="n">DeserializationConfig</span><span class="o">.</span><span class="na">Feature</span><span class="o">.</span><span class="na">UNWRAP_ROOT_VALUE</span><span class="o">))</span> <span class="o">{</span>
</span><span class="line">                    <span class="n">result</span> <span class="o">=</span> <span class="n">_unwrapAndDeserialize</span><span class="o">(</span><span class="n">jp</span><span class="o">,</span> <span class="n">valueType</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">,</span> <span class="n">deser</span><span class="o">);</span>
</span><span class="line">                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class="line">                    <span class="n">result</span> <span class="o">=</span> <span class="n">deser</span><span class="o">.</span><span class="na">deserialize</span><span class="o">(</span><span class="n">jp</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">);</span>
</span><span class="line">                <span class="o">}</span>
</span><span class="line">
</span><span class="line">            <span class="c1">// Need to consume the token too</span>
</span><span class="line">            <span class="n">jp</span><span class="o">.</span><span class="na">clearCurrentToken</span><span class="o">();</span>
</span><span class="line">            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span><span class="line">        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span><span class="line">            <span class="k">try</span> <span class="o">{</span>
</span><span class="line">                <span class="n">jp</span><span class="o">.</span><span class="na">close</span><span class="o">();</span><span class="c1">//关闭资源</span>
</span><span class="line">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">ioe</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>上述代码中有几点重要的方法：</p>

<ul>
  <li><code>JsonToken _initForReading(JsonParser jp)</code>方法:</li>
</ul>

<p>该方法主要是在反序列化开始的时候，获取JsonToken标识。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Jackson解析JSON数据 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">	<span class="kd">protected</span> <span class="n">JsonToken</span> <span class="nf">_initForReading</span><span class="o">(</span><span class="n">JsonParser</span> <span class="n">jp</span><span class="o">)</span>
</span><span class="line">        <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonParseException</span><span class="o">,</span> <span class="n">JsonMappingException</span>
</span><span class="line">    <span class="o">{</span>
</span><span class="line">        <span class="cm">/* 首先：必须只想一个token；没有token的情况只可以出现在第一次，和当前token被清除。</span>
</span><span class="line"><span class="cm">         * 此外，这里的JsonParser具体是指ReaderBaseParser实例，（还记得把String Reader处理吗？！）</span>
</span><span class="line"><span class="cm">         */</span>
</span><span class="line">        <span class="n">JsonToken</span> <span class="n">t</span> <span class="o">=</span> <span class="n">jp</span><span class="o">.</span><span class="na">getCurrentToken</span><span class="o">();</span> <span class="c1">//内部使用了简单地缓存ConcurrentHashMap实现</span>
</span><span class="line">        <span class="k">if</span> <span class="o">(</span><span class="n">t</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="c1">// and then we must get something...</span>
</span><span class="line">            <span class="n">t</span> <span class="o">=</span> <span class="n">jp</span><span class="o">.</span><span class="na">nextToken</span><span class="o">();</span> <span class="c1">// 判断当前是什么类型的JSON标识，比如对象JSON刚开始为&quot;START_OBJECT&quot;</span>
</span><span class="line">            <span class="k">if</span> <span class="o">(</span><span class="n">t</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                <span class="cm">/* [JACKSON-99] Should throw EOFException, closest thing</span>
</span><span class="line"><span class="cm">                 *   semantically</span>
</span><span class="line"><span class="cm">                 */</span>
</span><span class="line">                <span class="k">throw</span> <span class="k">new</span> <span class="nf">EOFException</span><span class="o">(</span><span class="s">&quot;No content to map to Object due to end of input&quot;</span><span class="o">);</span>
</span><span class="line">            <span class="o">}</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="k">return</span> <span class="n">t</span><span class="o">;</span>
</span><span class="line">    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<ul>
  <li><code>_findRootDeserializer(DeserializationConfig cfg, JavaType valueType)</code>方法：</li>
</ul>

<p>该方法在反序列化root-level值时调用。该方法使用了ConcurrentHashMap缓存来优化，只有root-level的反序列化才会被缓存，这主要是因为反序列化的输入和解决方案都是静态的，但是序列化却是动态的，所以做缓存只对反序列化。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Jackson解析JSON数据 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"> 	<span class="cm">/**</span>
</span><span class="line"><span class="cm">     * Method called to locate deserializer for the passed root-level value.</span>
</span><span class="line"><span class="cm">     */</span>
</span><span class="line">    <span class="kd">protected</span> <span class="n">JsonDeserializer</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="nf">_findRootDeserializer</span><span class="o">(</span><span class="n">DeserializationConfig</span> <span class="n">cfg</span><span class="o">,</span> <span class="n">JavaType</span> <span class="n">valueType</span><span class="o">)</span>
</span><span class="line">        <span class="kd">throws</span> <span class="n">JsonMappingException</span>
</span><span class="line">    <span class="o">{</span>
</span><span class="line">        <span class="c1">// First: have we already seen it?</span>
</span><span class="line">        <span class="n">JsonDeserializer</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">deser</span> <span class="o">=</span> <span class="n">_rootDeserializers</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">valueType</span><span class="o">);</span><span class="c1">//从缓存中获取对应类型的反序列化实例</span>
</span><span class="line">        <span class="k">if</span> <span class="o">(</span><span class="n">deser</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="k">return</span> <span class="n">deser</span><span class="o">;</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="c1">// Nope: need to ask provider to resolve it</span>
</span><span class="line">        <span class="n">deser</span> <span class="o">=</span> <span class="n">_deserializerProvider</span><span class="o">.</span><span class="na">findTypedValueDeserializer</span><span class="o">(</span><span class="n">cfg</span><span class="o">,</span> <span class="n">valueType</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span><span class="c1">//使用StdDeserializationContext默认的DeserializationContext实现。反序列化类实际上就是对某一类型进行详细描述，如下图。</span>
</span><span class="line">        <span class="k">if</span> <span class="o">(</span><span class="n">deser</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// can this happen?</span>
</span><span class="line">            <span class="k">throw</span> <span class="k">new</span> <span class="nf">JsonMappingException</span><span class="o">(</span><span class="s">&quot;Can not find a deserializer for type &quot;</span><span class="o">+</span><span class="n">valueType</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="n">_rootDeserializers</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">valueType</span><span class="o">,</span> <span class="n">deser</span><span class="o">);</span><span class="c1">//放入缓存中</span>
</span><span class="line">        <span class="k">return</span> <span class="n">deser</span><span class="o">;</span>
</span><span class="line">    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>反序列化类结构如图：<br />
<img src="/images/2014/09/deser.png" /></p>

<ul>
  <li><code>deserialize(JsonParser jp, DeserializationContext ctxt)</code>方法:</li>
</ul>

<p>由于解析对象为简单地Bean，所以调用<code>BeanDeserializer</code>转换为POJO对象。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Jackson解析JSON数据 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"> <span class="kd">public</span> <span class="kd">final</span> <span class="n">Object</span> <span class="nf">deserialize</span><span class="o">(</span><span class="n">JsonParser</span> <span class="n">jp</span><span class="o">,</span> <span class="n">DeserializationContext</span> <span class="n">ctxt</span><span class="o">)</span>
</span><span class="line">        <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonProcessingException</span>
</span><span class="line">    <span class="o">{</span>
</span><span class="line">        <span class="n">JsonToken</span> <span class="n">t</span> <span class="o">=</span> <span class="n">jp</span><span class="o">.</span><span class="na">getCurrentToken</span><span class="o">();</span>
</span><span class="line">        <span class="c1">// common case first:</span>
</span><span class="line">        <span class="k">if</span> <span class="o">(</span><span class="n">t</span> <span class="o">==</span> <span class="n">JsonToken</span><span class="o">.</span><span class="na">START_OBJECT</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">jp</span><span class="o">.</span><span class="na">nextToken</span><span class="o">();</span>
</span><span class="line">            <span class="k">return</span> <span class="nf">deserializeFromObject</span><span class="o">(</span><span class="n">jp</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="c1">// and then others, generally requiring use of @JsonCreator</span>
</span><span class="line">        <span class="k">switch</span> <span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">        <span class="k">case</span> <span class="nl">VALUE_STRING:</span>
</span><span class="line">            <span class="k">return</span> <span class="nf">deserializeFromString</span><span class="o">(</span><span class="n">jp</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">);</span>
</span><span class="line">        <span class="k">case</span> <span class="nl">VALUE_NUMBER_INT:</span>
</span><span class="line">            <span class="k">return</span> <span class="nf">deserializeFromNumber</span><span class="o">(</span><span class="n">jp</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">);</span>
</span><span class="line">        <span class="k">case</span> <span class="nl">VALUE_NUMBER_FLOAT:</span>
</span><span class="line">	    <span class="k">return</span> <span class="nf">deserializeFromDouble</span><span class="o">(</span><span class="n">jp</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">);</span>
</span><span class="line">        <span class="k">case</span> <span class="nl">VALUE_EMBEDDED_OBJECT:</span>
</span><span class="line">            <span class="k">return</span> <span class="n">jp</span><span class="o">.</span><span class="na">getEmbeddedObject</span><span class="o">();</span>
</span><span class="line">        <span class="k">case</span> <span class="nl">VALUE_TRUE:</span>
</span><span class="line">        <span class="k">case</span> <span class="nl">VALUE_FALSE:</span>
</span><span class="line">            <span class="k">return</span> <span class="nf">deserializeFromBoolean</span><span class="o">(</span><span class="n">jp</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">);</span>
</span><span class="line">        <span class="k">case</span> <span class="nl">START_ARRAY:</span>
</span><span class="line">            <span class="c1">// these only work if there&#39;s a (delegating) creator...</span>
</span><span class="line">            <span class="k">return</span> <span class="nf">deserializeFromArray</span><span class="o">(</span><span class="n">jp</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">);</span>
</span><span class="line">        <span class="k">case</span> <span class="nl">FIELD_NAME:</span>
</span><span class="line">        <span class="k">case</span> <span class="nl">END_OBJECT:</span> <span class="c1">// added to resolve [JACKSON-319], possible related issues</span>
</span><span class="line">            <span class="k">return</span> <span class="nf">deserializeFromObject</span><span class="o">(</span><span class="n">jp</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">);</span>
</span><span class="line">	<span class="o">}</span>
</span><span class="line">        <span class="k">throw</span> <span class="n">ctxt</span><span class="o">.</span><span class="na">mappingException</span><span class="o">(</span><span class="n">getBeanClass</span><span class="o">());</span>
</span><span class="line">    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>下面是具体的反序列化方法,如下：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Jackson解析JSON数据 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
</pre></td><td class="code"><pre><code class="java"><span class="line">
</span><span class="line">    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">deserializeFromObject</span><span class="o">(</span><span class="n">JsonParser</span> <span class="n">jp</span><span class="o">,</span> <span class="n">DeserializationContext</span> <span class="n">ctxt</span><span class="o">)</span>
</span><span class="line">        <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonProcessingException</span>
</span><span class="line">    <span class="o">{</span>
</span><span class="line">        <span class="k">if</span> <span class="o">(</span><span class="n">_nonStandardCreation</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="k">if</span> <span class="o">(</span><span class="n">_unwrappedPropertyHandler</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                <span class="k">return</span> <span class="nf">deserializeWithUnwrapped</span><span class="o">(</span><span class="n">jp</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">);</span>
</span><span class="line">            <span class="o">}</span>
</span><span class="line">            <span class="k">if</span> <span class="o">(</span><span class="n">_externalTypeIdHandler</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                <span class="k">return</span> <span class="nf">deserializeWithExternalTypeId</span><span class="o">(</span><span class="n">jp</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">);</span>
</span><span class="line">            <span class="o">}</span>
</span><span class="line">            <span class="k">return</span> <span class="nf">deserializeFromObjectUsingNonDefault</span><span class="o">(</span><span class="n">jp</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">
</span><span class="line">        <span class="kd">final</span> <span class="n">Object</span> <span class="n">bean</span> <span class="o">=</span> <span class="n">_valueInstantiator</span><span class="o">.</span><span class="na">createUsingDefault</span><span class="o">();</span><span class="c1">// 构造一个默认的初始化类型对象，对象属性值使用初始化默认值。</span>
</span><span class="line">        <span class="k">if</span> <span class="o">(</span><span class="n">_injectables</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">            <span class="n">injectValues</span><span class="o">(</span><span class="n">ctxt</span><span class="o">,</span> <span class="n">bean</span><span class="o">);</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="k">for</span> <span class="o">(;</span> <span class="n">jp</span><span class="o">.</span><span class="na">getCurrentToken</span><span class="o">()</span> <span class="o">!=</span> <span class="n">JsonToken</span><span class="o">.</span><span class="na">END_OBJECT</span><span class="o">;</span> <span class="n">jp</span><span class="o">.</span><span class="na">nextToken</span><span class="o">())</span> <span class="o">{</span> <span class="c1">//迭代输入流来设置各个属性的值</span>
</span><span class="line">            <span class="n">String</span> <span class="n">propName</span> <span class="o">=</span> <span class="n">jp</span><span class="o">.</span><span class="na">getCurrentName</span><span class="o">();</span>
</span><span class="line">            <span class="c1">// Skip field name:</span>
</span><span class="line">            <span class="n">jp</span><span class="o">.</span><span class="na">nextToken</span><span class="o">();</span><span class="c1">// 迭代到下一个输入流的token名字，即使在POJO中没有对应属性，则会调用_handleUnknown来处理。</span>
</span><span class="line">            <span class="n">SettableBeanProperty</span> <span class="n">prop</span> <span class="o">=</span> <span class="n">_beanProperties</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">propName</span><span class="o">);</span> <span class="c1">//具体实现如下</span>
</span><span class="line">            <span class="k">if</span> <span class="o">(</span><span class="n">prop</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// 如果在POJO中有对应属性，则返回kv</span>
</span><span class="line">                <span class="k">try</span> <span class="o">{</span>
</span><span class="line">                    <span class="n">prop</span><span class="o">.</span><span class="na">deserializeAndSet</span><span class="o">(</span><span class="n">jp</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">,</span> <span class="n">bean</span><span class="o">);</span><span class="c1">//根据类型调用具体的方法设置属性值，比如StringDeserializer类对字符串。</span>
</span><span class="line">                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                    <span class="n">wrapAndThrow</span><span class="o">(</span><span class="n">e</span><span class="o">,</span> <span class="n">bean</span><span class="o">,</span> <span class="n">propName</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">);</span>
</span><span class="line">                <span class="o">}</span>
</span><span class="line">                <span class="k">continue</span><span class="o">;</span>
</span><span class="line">            <span class="o">}</span>
</span><span class="line">            <span class="n">_handleUnknown</span><span class="o">(</span><span class="n">jp</span><span class="o">,</span> <span class="n">ctxt</span><span class="o">,</span> <span class="n">bean</span><span class="o">,</span> <span class="n">propName</span><span class="o">);</span><span class="c1">//这里会根据上面的配置来决定处理方案</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="c1">// BeanPropertyMap类是一个存储属性名到SettableBeanProperty实例之间的映射的工具类。该类主要代替HashMap，做了一些业务优化。</span>
</span><span class="line">    <span class="kd">public</span> <span class="n">SettableBeanProperty</span> <span class="nf">find</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span>
</span><span class="line">    <span class="o">{</span>
</span><span class="line">        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()</span> <span class="o">&amp;</span> <span class="n">_hashMask</span><span class="o">;</span><span class="c1">//hash找到bucket位置</span>
</span><span class="line">        <span class="n">Bucket</span> <span class="n">bucket</span> <span class="o">=</span> <span class="n">_buckets</span><span class="o">[</span><span class="n">index</span><span class="o">];</span><span class="c1">//</span>
</span><span class="line">        <span class="c1">// Let&#39;s unroll first lookup since that is null or match in 90+% cases</span>
</span><span class="line">        <span class="k">if</span> <span class="o">(</span><span class="n">bucket</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span><span class="c1">//如果不存在，则返回null</span>
</span><span class="line">            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="c1">// Primarily we do just identity comparison as keys should be interned</span>
</span><span class="line">        <span class="k">if</span> <span class="o">(</span><span class="n">bucket</span><span class="o">.</span><span class="na">key</span> <span class="o">==</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// 当没有hash碰撞时，则会相等</span>
</span><span class="line">            <span class="k">return</span> <span class="n">bucket</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="k">while</span> <span class="o">((</span><span class="n">bucket</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="na">next</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span><span class="c1">//不能直接相等，则遍历找到bucket里面所有的key</span>
</span><span class="line">            <span class="k">if</span> <span class="o">(</span><span class="n">bucket</span><span class="o">.</span><span class="na">key</span> <span class="o">==</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">                <span class="k">return</span> <span class="n">bucket</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
</span><span class="line">            <span class="o">}</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">        <span class="c1">// Do we need fallback for non-interned Strings?</span>
</span><span class="line">        <span class="k">return</span> <span class="nf">_findWithEquals</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">index</span><span class="o">);</span>
</span><span class="line">    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="a-idjsondeserializerjacksonjavaa"><a id="JsonDeserializer">Jackson序列化Java对象</a></h2>
<p><code>Jackson</code>工具包对外提供看好几种序列化接口，比如转换为String对象，Byte[]数组，或者直接写到stream中等等，但是不管如何，其内部实现的核心方法都是</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Jackson序列化Java对象 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="kd">protected</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">_configAndWriteValue</span><span class="o">(</span><span class="n">JsonGenerator</span> <span class="n">jgen</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>因此，这里就选择常用的<code>writeValueAsString(Object value)</code>来解析器内部实现。</p>

<blockquote>
  <blockquote>
    <p>Note：虽然在<code>Jackson</code>中提供了<code>public void writeValue(Writer w, Object value)</code>的通用方法来序列化java对象，对于需要转换为String类型的需求，只需要<code>StringWriter</code>就可以调用writeValue，但是由于这种序列化对性能要求高，并且使用频繁，所以单独提供更高效的实现方式。而正由于在项目代码中AsString 场景十分多，所以这里选择<code>writeValueAsString</code>方法分析。</p>
  </blockquote>
</blockquote>

<h3 id="section-1">序列化方法处理流程</h3>

<p><code>writeValueAsString(Object value)</code>其处理和反序列化很相似，基本流程为：</p>

<ol>
  <li><em>首先，构建通用序列化基础方法所需要的参数类型对象；</em></li>
  <li><em>其次，对序列化类型进行分析，根据注解或者”get方法名(比如getXxx,isXxx)”等来构建需要序列化的属性</em></li>
  <li><em>然后，通过反射机制分别对所有的序列化属性进行处理：通过发现拿到对应的值,getxxx方法等</em></li>
  <li><em>拼接字符串：其内部是根据类型写入一些开始结束符号，例如{,[等，在其中嵌入步骤3的解析设值</em></li>
  <li><em>返回最后得到的字符串内容</em></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/26/Vim-Plugin-On-Mac/">Mac OS系统Vim酷炫插件安装</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-26T22:21:35+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:21 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="section">目录</h2>

<ol>
  <li><a href="#Intro">前言</a></li>
  <li><a href="#Shell">Vim一键安装脚本</a></li>
  <li><a href="#Zope">手动安装zope</a></li>
  <li><a href="#End">后记</a></li>
</ol>

<h2 id="a-idintroa"><a id="Intro">前言</a></h2>

<p>vim工具，对于一个程序猿来讲，是使用非常普遍的。以前在Ubuntu上安装<code>ma6174</code>大神提供的安装脚本，一键安装一些非常好用的插件，但是对于Mac来说，一直不能很好地执行一件安装。</p>

<p>这里，记录一下，使用大神提供的安装脚本出现问题的解决方法。</p>

<h2 id="a-idshellvima"><a id="Shell">Vim一键安装脚本</a></h2>

<p><code>ma6174</code>大神提供的安装脚本，不能直接在Mac 上运行，直接copy到本地，脚本为：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Vim一键安装脚本 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="c">#!/bin/bash</span>
</span><span class="line">
</span><span class="line">brew install vim ctags git astyle
</span><span class="line">sudo <span class="nv">ARCHFLAGS</span><span class="o">=</span>-Wno-error<span class="o">=</span>unused-command-line-argument-hard-error-in-future easy_install twisted
</span><span class="line">
</span><span class="line">sudo easy_install -ZU autopep8 twisted
</span><span class="line">sudo ln -s /usr/bin/ctags /usr/local/bin/ctags
</span><span class="line">mv -f ~/vim ~/vim_old
</span><span class="line"><span class="nb">cd</span> ~/ <span class="o">&amp;&amp;</span> git clone https://github.com/ma6174/vim.git
</span><span class="line">mv -f ~/.vim ~/.vim_old
</span><span class="line">mv -f ~/vim ~/.vim
</span><span class="line">mv -f ~/.vimrc ~/.vimrc_old
</span><span class="line">mv -f ~/.vim/.vimrc ~/
</span><span class="line">git clone https://github.com/gmarik/vundle.git ~/.vim/bundle/vundle
</span><span class="line">vim vim_mac -c <span class="s2">&quot;BundleInstall&quot;</span> -c <span class="s2">&quot;q&quot;</span> -c <span class="s2">&quot;q&quot;</span>
</span><span class="line">rm vim_mac
</span><span class="line"><span class="nb">echo</span> <span class="s2">&quot;安装完成&quot;</span>
</span><span class="line">
</span></code></pre></td></tr></table></div></figure></notextile></div>

<blockquote>
  <blockquote>
    <p>Note：上面的脚本是直接从一键安装命令中的build脚本部分拷贝的，因为我的Mac无法直接执行一键安装命令。此外，Mac必须安装HomeBrew工具，关于该工具的安装使用，请参考 <a href="http://brew.sh/index_zh-cn.html">http://brew.sh/index_zh-cn.html</a></p>
  </blockquote>
</blockquote>

<h2 id="a-idzopezopea"><a id="Zope">手动安装zope</a></h2>

<p>在上面的脚本安装完成之后，控制台执行<code>vim</code>命令，会报错：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>手动安装zope </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">Error detected <span class="k">while</span> processing /Users/rum/.vim/plugin/client.vim:
</span><span class="line">line 314:
</span><span class="line">Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span><span class="line">File <span class="s2">&quot;&quot;</span>, line 2, in
</span><span class="line">File <span class="s2">&quot;/Library/Python/2.7/site-packages/Twisted-14.0.0-py2.7-macosx-10.9-intel.egg/twisted/init.py&quot;</span>, line 53, in
</span><span class="line">checkRequirements<span class="o">()</span>
</span><span class="line">File <span class="s2">&quot;/Library/Python/2.7/site-packages/Twisted-14.0.0-py2.7-macosx-10.9-intel.egg/twisted/__init_.py&quot;</span>, line 37, in _checkRequirements
</span><span class="line">raise ImportError<span class="o">(</span>required + <span class="s2">&quot;: no module named zope.interface.&quot;</span><span class="o">)</span>
</span><span class="line">ImportError: Twisted requires zope.interface 3.6.0 or later: no module named zope.interface.
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>然后，Google搜了各种方法都不生效，无奈执行，只能源码安装了。安装起来很简单，直接执行就好了。</p>

<ol>
  <li>源码下载地址：<a href="https://pypi.python.org/packages/source/z/zope.interface/zope.interface-4.1.0.tar.gz#md5=ac63de1784ea0327db876c908af07a94">https://pypi.python.org/packages/source/z/zope.interface/zope.interface-4.1.0.tar.gz#md5=ac63de1784ea0327db876c908af07a94</a></li>
  <li>解压缩之后，执行安装命令:<code>sudo python setup.py install</code>。</li>
</ol>

<p>完成之后，在执行	<code>vim</code>命令，就不会报错了。</p>

<h2 id="a-idenda"><a id="End">后记</a></h2>

<p>安装完插件之后，果然用起来十分爽哇！！此外，<code>ma6174</code>大神还提供了一些使用<code>Tips</code>。</p>

<h3 id="python">编写python程序</h3>

<ol>
  <li>自动插入头信息：
    <ul>
      <li><code>#!/usr/bin/env python</code></li>
      <li><code># coding=utf-8</code></li>
      <li>输入<code>.</code>或按<code>TAB</code>键会触发代码补全功能</li>
      <li><code>:w</code>保存代码之后会自动检查代码错误与规范</li>
      <li>按<code>F6</code>可以按<code>pep8</code>格式对代码格式优化</li>
      <li>按<code>F5</code>可以一键执行代码</li>
    </ul>
  </li>
</ol>

<h3 id="section-1">多窗口操作</h3>

<ol>
  <li>使用<code>:sp + 文件名</code>可以水平分割窗口
    <ul>
      <li>使用<code>:vs + 文件名</code>可以垂直分割窗口</li>
      <li>使用<code>Ctrl + w</code>可以快速在窗口间切换</li>
    </ul>
  </li>
</ol>

<h3 id="markdown">编写markdown文件</h3>

<ol>
  <li>编写markdown文件(<code>*.md</code>)的时候，在normal模式下按 <code>md</code> 即可在当前目录下生成相应的<code>html</code>文件
    <ul>
      <li>生成之后还是在normal模式按<code>fi</code>可以使用firefox打开相应的<code>html</code>文件预览</li>
      <li>当然也可以使用万能的<code>F5</code>键来一键转换并打开预览</li>
      <li>如果打开过程中屏幕出现一些混乱信息，可以按<code>Ctrl + l</code>来恢复</li>
    </ul>
  </li>
</ol>

<h3 id="section-2">快速注释</h3>

<ul>
  <li>按<code> \ </code> 可以根据文件类型自动注释</li>
</ul>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/11/Redis-Cookbook-Implementing-OAuth/">Redis Cookbook 之 基于Redis 实现Oauth协议</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-11T22:21:35+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>11</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:21 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="section">目录</h2>

<ol>
  <li><a href="#Problem">问题</a></li>
  <li><a href="#Solution">解决方法</a></li>
  <li><a href="#Discussion">讨论</a></li>
</ol>

<h2 id="a-idproblema"><a id="Problem">问题</a></h2>

<p>在我们案例里，我们将实现一个数据模型和交互来支持Oauth v1.0a API。一般常常是基于MySQL或者其他的RDBMS实现，但是我们可以利用Redis的数据结构更高效的实现Oauth协议。</p>

<h2 id="a-idsolutiona"><a id="Solution">解决方法</a></h2>

<p>我们不会去实现Oauth的API或者交互。这里我们仅仅感兴趣的是这种类型场景里所需要的数据。我们将在Redis里面存储五种类型的数据：</p>

<ul>
  <li>consumer keys</li>
  <li>consumer secrets</li>
  <li>request tokens</li>
  <li>access tokens</li>
  <li>nonces</li>
</ul>

<p>所以我们的需求如下：通过一对<code>key</code>和<code>secret</code>标识的应用（客户）。这些客户根据他们的需求会有许多次的请求和访问token，并且每个用户/时间戳对是唯一的。</p>

<p>根据他们的要求和交互情况，这种类型的数据可以被存储在<code>hashes</code>、<code>sets</code>和<code>strings</code>。</p>

<h2 id="a-iddiscussiona"><a id="Discussion">讨论</a></h2>

<h3 id="section-1">3.1 初始设置</h3>

<p>一开始，在客户发出一个请求之前，他们必须输入他们的数据。我们将这个数据和客户信息放入hash中。当他注册我们系统的时候，key是我们为特定的商户存储的数据之一：</p>

<pre><code>HMSET /consumers/key:dpf43f3p2l4k3l03 secret kd94hf93k423kf44 created_at 201103060000 redirect_url http://www.example.com/oauth_redirect name test_application
</code></pre>

<p>如同命令所示，这个hash包含它的正常的数据，并且可以随着时间进行扩展。这样，和Memcache一样，或者以不同的keys来存储所有的值，或者存储像JSON一样的数据。</p>

<pre><code>HSET hash-name key value
    Sets a value on a hash with the given key. As with other Redis commands, if the hash doesn’t exist, it’s created.
    
HMSET hash-name key1 value1 [key2 value2 ...]
    Allows you to set several values in a hash with a single command
</code></pre>

<h3 id="token">3.2 获取一个请求token</h3>

<p>为了获取一个请求token，客户发送他们的key、时间戳、唯一生成随机数、回调url和一个请求的签名（使用客户的secret对请求路径和参数hash计算结果）。</p>

<p>API提供者需要验证签名是否正确，检查随机数/时间戳在之前是否使用过，并且生成一个新的请求token。</p>

<p>为了做到这样，server需要获取客户的数据：</p>

<pre><code>HGETALL /consumers/key:dpf43f3p2l4k3l03
</code></pre>

<p>然后检查这个随机数是否以前使用过：</p>

<pre><code>SADD /nonces/key:dpf43f3p2l4k3l03/timestamp:20110306182600 dji430splmx33448
</code></pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/10/Redis-Cookbook-Redis-KeyValue-Store/">Redis Cookbook 之 Redis 键值对存储服务</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-10T22:21:35+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:21 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="section">目录</h2>

<ol>
  <li><a href="#Problem">问题</a></li>
  <li><a href="#Solution">解决方法</a></li>
  <li><a href="#Discussion">讨论</a></li>
</ol>

<h2 id="a-idproblema"><a id="Problem">问题</a></h2>

<p>许多的应用服务都需要存储关于使用，配置或者其他相关的信息的临时数据，这些数据结构并不适合存储在关系数据库中。
通常情况下，开发者会是MySQL或者其他RDBMS来存储这种数据。在这里，我们将使用Redis和它内建的数据结构，以一种更轻量级、更快速、更宽松的方式完成存储应用临时数据的功能。</p>

<h2 id="a-idsolutiona"><a id="Solution">解决方法</a></h2>

<p>Redis本身的定位并不仅仅是<code>key/value</code>存储服务，同时也可以作为存储数据结构的服务器。这意味着，在传统的<code>key/value</code>存储功能之上，它还提供给你一些存储和操作应用数据的方式。
我们将使用这些数据结构和命令来存储应用示例数据：比如，我们在一些<code>regular keys</code>里面存储有用的计数器，在<code>Redis hashes</code>里面存储用户对象，以及使用<code>sets</code>实现朋友圈（像Google+）。</p>

<h2 id="a-iddiscussiona"><a id="Discussion">讨论</a></h2>

<h3 id="section-1">3.1 存储应用使用计数器</h3>

<p>首先，让我们开始存储一些非常基础的事情：计数器。想象我们运营一个商业的社交网络，然后想要追踪<code>profile/page</code>的访问数据。我们可以在RDBMS的存储我们页数据的表里面增加一列，
但是希望我们的流量足够高以至于每次更新这一列会带来一些麻烦。因此，我们需要更快的工具来更新和查询，所以我们使用Redis来代替。</p>

<p>由于Redis命令的原子性，我们知道如果我们存储一个计数器的key，则我们可以使用命令，比如：<code>INCR(或者INCRBY)和DECR(或者DECRBY)</code>，来增加增加或者减少它包含的值。所以，通过为我们的数据设计一个合适的命名保证我们的计数器单次操作成本微乎其微。</p>

<p>Redis系统内实际上并没有约定的方法来组织keys，但是许多人（包括作者）都喜欢使用<code>冒号：</code>来区分关键字从而创建keys，因此在这里也这样约定。为了存储我们的社交网络页面访问数据，我们可以有一个像<code>visits:pageid:totals</code>的命名，比如页面id为635，则命名为<code>visits:635:totals</code>。如果我们已经在一些地方存储访问数据，我们可以首先根据这些数据产生redis的keys，并且设置对应的值，比如：</p>

<pre><code>	SET visits:1:totals 21389 
	SET visits:2:totals 1367894 
	(...)
</code></pre>

<p>当访问一个给定的页面，一个简单地<code>INCR</code>命令将更新Redis中的计数器：</p>

<pre><code>	INCR visits:635:totals
</code></pre>

<p>然后我们可以获取任何页面在任何时候的访问次数，这只需要通过简单地<code>GET</code>命令：</p>

<pre><code>	GET visits:635:totals
</code></pre>

<p>你也可以让你的命令更智能，比如你可以在人们查看页面的时候，显示当前该页面被访问的次数给他看。当然，你也可以计算他自己访问的次数，所以你甚至不需要执行最后的<code>GET</code>命令：你可以利用<code>INCR</code>命令返回值的特点，因为<code>INCR</code>命令会返回自增之后的计数值。一个简单地关于访问和计数器的伪代码如下所示：</p>

<pre><code>	1. 访问者访问页面.
	2. 我们 INCR 相关页面的访问计数器 (比如：INCR visits:635:totals）		3. 我们获取INCR命令的返回值。
	4. 我们展示返回的值在用户页面上。
</code></pre>

<p>这种方式我们保证用户在查看页面的时候，常常可以看见实时计数值，以及他自己访问的计数–着所有都可以使用Redis命令。</p>

<h3 id="hashes">3.2 存储对象数据在hashes内</h3>

<p>Redis关于hashes的实现对于存储对象数据应用来说是一个很好的方案。在下面的例子里，我们将调查我们怎样使用<code>hashes</code>来在给定系统上存储用户相关的信息。</p>

<p>我们将开始设计一个key命名来存储我们的用户。在此之前，我们使用分号来分割我们的关键字，进而产生意义丰富的key。为了达到这个案例的目的，我们将构建一个简单的key，形如：<code>users:alias</code>，其中<code>alias</code>是二进制安全的字符串。所以，为了存储一个叫做<code>John Doe</code>的用户，我们将建一个hash叫做<code>users:jdoe</code>。</p>

<p>我们也假设我们将要存储关于用户的许多属性，比如全名、邮件地址、电话号码、以及访问我们英语的次数。我们将使用Redis的<code>hash管理命令</code>–像<code>HSET</code>、<code>HGET</code>和<code>HINCRBY</code>–存储用户的这些信息。</p>

<pre><code>	redis&gt; hset users:jdoe name "John Doe" 
	(integer) 1
	
	redis&gt; hset users:jdoe email "jdoe@test.com" 
	(integer) 1
	
	redis&gt; hset users:jdoe phone "+1555313940" 
	(integer) 1
	
	redis&gt; hincrby users:jdoe visits 1 
	(integer) 1
</code></pre>

<p>随着我们hash的建立，我们可以在合适的地方通过<code>HGET</code>获取简单地属性值或者通过<code>HGETALL</code>命令所有hash对象数据，如同下面的示例：</p>

<pre><code>	redis&gt; hget users:jdoe email 
	"jdoe@test.com"

	redis&gt; hgetall users:jdoe
	1) "name"
	2) "John Doe"
	3) "email"
	4) "jdoe@test.com" 5) "phone"
	6) "+1555313940" 7) "visits"
	8) "1"
</code></pre>

<p>还有辅助的命令，比如<code>HKEYS</code>，该命令返回一个特定的hash里面存储的所有keys；<code>HVALS</code>，该命令仅仅返回values。当从你应用的Redis中检索数据时，你可能会发现使用<code>HGETALL</code>或者其他命令很有用，这其实取决于你想怎样检索你的数据。</p>

<pre><code>	redis&gt; hkeys users:jdoe 
	1) "name"
	2) "email"
	3) "phone"
	4) "visits"

	redis&gt; hvals users:jdoe 
	1) "John Doe"
	2) "jdoe@test.com"
	3) "+1555313940"
	4) "1"
</code></pre>

<p>关于我们用户hash的其他命令列表，你可以详细阅读 <code>Redis official documentation for hash commands</code>，这里面包含他自己的使用<code>hashes</code>管理数据的示例。</p>

<h3 id="sets">3.2 使用sets存储用户的朋友圈</h3>

<p>为了完成Redis特有的方式存储数据，我们看看怎么样使用Redis支持的sets来创建和google+相似的朋友圈功能。sets天生就适应朋友圈，因为sets代码数据的集合，并且有一些天生的功能来做一些有趣的事情，比如交集和并集。</p>

<p>首先，让我们定义一个朋友圈的命名。我们想要为我们每一个用户存储一些朋友圈，所以我们的key需要包含用户和实际的朋友圈。举个例子，<code>John Doe</code>的家庭圈可能有一个key像<code>circle:jdoe:family</code>样子。相似地，他的足球训练朋友可能在key为<code>circle:jdoe:soccer</code>的set里面。这里没有key设计的设置规则，所以常常以一种对我们应用有意义的方式来设计它们。</p>

<p>现在，我们知道存储我们sets里面的keys，接下来，我们来创建<code>John Doe</code>的家庭集和足球朋友集。在集合本身里面，我们可以通过用户id来获取Redis里其他的keys。如果我们想要获取属于<code>John Doe</code>家庭圈用户的列表，和它们的用户信息，我们可以使用我们set的操作结果，然后为每一个用户提取真实的hashes（使用hashes来存储用户信息）。</p>

<pre><code>	redis&gt; sadd circle:jdoe:family users:anna 
	(integer) 1

	redis&gt; sadd circle:jdoe:family users:richard
	(integer) 1 
	
	redis&gt; sadd circle:jdoe:family users:mike
	(integer) 1 
	
	redis&gt; sadd circle:jdoe:soccer users:mike
	(integer) 1 
	
	redis&gt; sadd circle:jdoe:soccer users:adam
	(integer) 1 
	
	redis&gt; sadd circle:jdoe:soccer users:toby
	(integer) 1 
	
	redis&gt; sadd circle:jdoe:soccer users:apollo
	(integer) 1
</code></pre>

<p>需要记住的是，在上面的例子里，我们需要规范化我们set的成员通过使用实际的id数值而不是<code> users:name</code>。虽然上面的例子工作得很好，但它可能为了性能原因牺牲一些可读性而获取更快的速度和更高的内存使用效率。</p>

<p>现在我们有一个set叫做<code>circle:jdoe:family</code>,带有三个值（分别是：users:anna, users:richard, and users:mike），第二个叫做<code>	circle:jdoe:soccer</code>,带有四个值（分别是：users:mike, users:adam, users:toby, and users:apollo）。它们的值仅仅只是字符串，但是通过使用字符串对我们来说是有意义的（这和我们设计用户的hashes很相似），我们可以使用<code>SMEMBERS</code>命令的结果进而获取特点用户的信息。如下面的例子：</p>

<pre><code>	redis&gt; smembers circle:jdoe:family 
	1) "users:richard"
	2) "users:mike"
	3) "users:anna"

	redis&gt; hgetall users:mike 
	(...)
</code></pre>

<p>现在，我们已经知道了怎么在sets里面存储信息了，我们可以扩展这个只是，做一些有趣的事情，比如获取属于这两个sets里面的人，或者获取一个<code>John Doe</code>添加到我们系统朋友圈中的完整的用户列表。</p>

<pre><code>	redis&gt; sinter circle:jdoe:family circle:jdoe:soccer 
	1) "users:mike"

	redis&gt; sunion circle:jdoe:family circle:jdoe:soccer 
	1) "users:anna"
	2) "users:mike"
	3) "users:apollo" 
	4) "users:adam"
	5) "users:richard" 
	6) "users:toby"
</code></pre>

<p>根据我们的结果，<code>Mike</code>在<code>John Doe</code>的家庭圈和足球圈里面，通过两个圈的并集，我们也可以获取完整地成员列表。</p>

<p>如你所见，Redis sets使得RDBMS一些查询变得非常简单。Redis完成得非常的快，使得对于那些管理集合操作的应用来说，<code>Redis sets</code>是一个理想的候选者。朋友圈就是一个例子，此外像 推荐或者甚至文本搜素也很适合。在随后的案例里面，将会看到更深入的例子。</p>

<pre><code>SET key value
	Sets the key to hold the given value. Existing data is overwritten (even if of a dif- ferent data type).	

GET key
	Returns the content held by the key. Works only with string values.

INCR key
	Increments the integer stored at key by 1.

INCRBY key value
	Performs the same operation as INCR, but incrementing by value instead.	
DECR key
	Decrements the integer stored at key by 1.

DECRBY key value
	Performs the same operation as DECR, but decrementing by value instead
</code></pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/10/Redis-CookBook-Redis-Data-Types/">Redis Cookbook 之 Redis数据类型</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-10T22:21:35+08:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:21 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="section">目录</h2>

<ol>
  <li><a href="#Problem">问题</a></li>
  <li><a href="#Solution">解决方法</a></li>
  <li><a href="#Discussion">讨论</a></li>
</ol>

<h2 id="a-idproblema"><a id="Problem">问题</a></h2>

<p>首先，你需要了解<code>Redis</code>的数据类型，这样才能够为特定的应用提供更好的<code>Redis</code>使用方式和性能。</p>

<h2 id="a-idsolutiona"><a id="Solution">解决方法</a></h2>

<p>和大部分其他的<code>NoSQL</code>方案和<code>key-value</code>存储引擎不同，<code>Redis</code>包含一些内建的数据类型，允许开发者可以使用有意义的语义方式来构建他们的数据。在<code>Redis</code>内部操作指定类型的数据时，预定义的数据类型一般会比外部定义数据类型要操作更快。</p>

<h2 id="a-iddiscussiona"><a id="Discussion">讨论</a></h2>

<p>在我们深入特定的数据类型之前，先来了解一些在设计<code>Key</code>数据结构的时候需要关注的事情：</p>

<ul>
  <li>
    <p>定义<code>key</code>空间时需要一致。由于一个key可以包含任意的字符，你可以使用分隔符去为自己的业务定义有意义的命名。例如：<code> cache:project:319:tasks</code>，每一个冒号就是一个命名分隔符。</p>
  </li>
  <li>
    <p>当定义自己的<code>key</code>时，尝试限制合适的大小。从存储中检索一个key是需要比较操作的，所以保证<code>key</code>长度足够的小是一个很好的建议。此外，更小的<code>key</code>长度还会节省内存的使用。</p>
  </li>
  <li>
    <p>即使<code>key</code>不能够特别的大，但是保持特别小的<code>key</code>并不会带来非常大的性能提升。这意味着，你设计自己的<code>key</code>时需要综合考虑<code>key</code>的易读性和正常的键长度。</p>
  </li>
</ul>

<p>因此，当键设计成<code>c:p:319:t</code>或者<code>user 123</code>是相当失败的，前面一个可读性很差，后面一个包含空格。另一方面，像<code>cache:project:319:tasks</code>，<code>lastchatmessage</code>，<code>464A1E96B2D217EBE87449FA8B70E6C7D112560C</code>的<code>key</code>都是很好的，因为他们都是有语义的词（最后一个是SHA1哈希值，虽然很难猜测他的语义，但是这对于存储了对应的对象，你就可以计算出hash值了）。</p>

<h3 id="strings">3.1 Strings</h3>

<p>这是<code>Redis</code>里面最简单的数据类型：字符串。<code>Strings</code>也是其他<code>key-value</code>存储引擎中典型的数据类型。你可以存储任意类型的字符串，包括二进制数据。比如：你可能想要为<code>社交网络中的头像</code>缓存图片数据。你需要考虑的唯一一件事情就是在<code>Redis</code>里面不允许特定的值大小超过<code>512M</code>。</p>

<h3 id="lists">3.2 Lists</h3>

<p>在<code>Redis</code>存储里面，<code>  Lists</code>是一个有序的二进制安全的字符串列表，使用<code>linked list</code>来实现。这意外者，当通过一个指定的索引获取元素的时候，会是一个很慢的操作，但是在这个数据结构的头部或者尾部增加元素是非常快的。你可能想要基于<code>Lists</code>去实现<code>queues</code>之类的数据结构。关于这点，后文会说到。</p>

<h3 id="hashes">3.3 Hashes</h3>

<p>和传统的hash表很像，在<code>Redis</code>中<code>hashes</code>在特定的key里面存储一些<code>fields</code>和他们对应的值。<code>hashes</code>是需要映射复杂对像的完美选项，通过使用对象属性的<code>fields</code>（比如一个对象有多个属性：“color”,“brand”, “license plate”）。</p>

<h3 id="sets-and-sorted-sets">3.4 Sets and Sorted Sets</h3>

<p>在<code>Redis</code>中，<code>sets</code>是一个无序的二进制安全的字符串集合。在给定的<code>set</code>中是不存在重复的元素的。比如，当你尝试在一个<code>set</code>中添加两次<code>wheel</code>时，<code>Redis</code>会忽略第二次插入操作。<code>sets</code>允许你执行传统语言中<code>set</code>的相关操作，比如获取集合的交集和并集。</p>

<p>虽然这个和<code>lists</code>看起来很相似，但是他们实现是非常不同的，并且由于他们不同的特性而决定适应不同的应用需求。此外，set的内存占用要比<code>lists</code>高一些。</p>

<p><code>Sorted sets</code>是<code>sets</code>的特例，通过定义<code>score</code>来实现排序，此外也是经典的二进制安全字符串。这个<code>score</code>允许你通过使用<code>ZRANGE</code>命令查询一个有序的元素列表。后面，会介绍一些关于<code>sets and sorted sets</code>的使用实例。</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/03/Query-DB-Python-Shell/">使用Python操作线上数据库脚本</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-07-03T22:21:35+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>3</span><span class='date-suffix'>rd</span>, <span class='date-year'>2014</span></span> <span class='time'>10:21 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="section">目录</h2>

<ol>
  <li><a href="#Intro">前言</a></li>
  <li><a href="#Script">Python脚本</a></li>
</ol>

<h2 id="a-idintroa"><a id="Intro">前言</a></h2>

<p>最近对于线上一些数据需要进行过滤导到本地来，或者对一些运营人员给的文本数据，需要在线上数据库跑出对应的结果出来，因此，需要通过一个脚本来执行。因为，现在服务器基本上会默认安装python，所以这里存一份脚本备用。</p>

<h2 id="a-idscriptpythona"><a id="Script">Python脚本</a></h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Python脚本 </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="c">#!/usr/bin/python</span>
</span><span class="line"><span class="c">#coding=utf-8</span>
</span><span class="line"><span class="kn">import</span> <span class="nn">os</span><span class="p">;</span>
</span><span class="line"><span class="kn">import</span> <span class="nn">MySQLdb</span><span class="p">;</span>
</span><span class="line"><span class="kn">import</span> <span class="nn">sys</span><span class="p">;</span>
</span><span class="line"><span class="nb">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
</span><span class="line"><span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span class="line"><span class="nb">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">&quot;hotelseq.txt&quot;</span><span class="p">)</span>
</span><span class="line"><span class="n">outfile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s">&quot;customer.txt&quot;</span><span class="p">,</span><span class="s">&#39;w+&#39;</span><span class="p">)</span>
</span><span class="line"><span class="n">conn</span><span class="o">=</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span><span class="n">user</span><span class="o">=</span><span class="s">&#39;root&#39;</span><span class="p">,</span><span class="n">passwd</span><span class="o">=</span><span class="s">&#39;123456&#39;</span><span class="p">,</span><span class="n">db</span><span class="o">=</span><span class="s">&#39;test&#39;</span><span class="p">,</span><span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span><span class="n">charset</span><span class="o">=</span><span class="s">&quot;utf8&quot;</span><span class="p">)</span>
</span><span class="line"><span class="n">cur</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span class="line"><span class="n">order_cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
</span><span class="line">    <span class="n">line</span><span class="o">=</span><span class="nb">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span class="line">    <span class="k">print</span> <span class="n">line</span>
</span><span class="line">    <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="p">:</span>
</span><span class="line">        <span class="k">break</span>
</span><span class="line">    <span class="n">count</span><span class="o">=</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s">&quot;select cus.customer_state,cus.name from crm_customer_hotel as hotel join crm_customer as cus on hotel.customer_serial_number=cus.serial_number where hotel.hotel_seq=&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>
</span><span class="line">    <span class="n">result</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span class="line">    <span class="k">print</span> <span class="n">result</span>
</span><span class="line">    <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
</span><span class="line">        <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;  &quot;</span><span class="o">+</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span class="line">        <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</span><span class="line"><span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class="line"><span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class="line"><span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/27/Intelij-IDEA-Keymap/">常用快捷键（备用）</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-06-27T22:21:35+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:21 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="section">目录</h2>

<ol>
  <li><a href="#Intro">前言</a></li>
  <li><a href="#Keymap">Idea 快捷键</a></li>
  <li><a href="#Sublime">Sublime 快捷键</a></li>
</ol>

<h2 id="a-idintroa"><a id="Intro">前言</a></h2>

<p>Intelij IDEA一些快捷键和 Eclipse不同，所以对一些快捷键进行记录，备查。</p>

<h2 id="a-idkeymapidea-a"><a id="Keymap">Idea 快捷键</a></h2>

<h3 id="section-1">视图快捷键</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>idea keymap </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="kconfig"><span class="line">快速查看方法注释文档          Ctrl + Q
</span><span class="line">
</span><span class="line">快速查询类名                   Ctrl + N
</span><span class="line">
</span><span class="line">快速查询文件名                Ctrl + Shift + N
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="section-2">编辑快捷键</h3>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>idea keymap </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="kconfig"><span class="line">代码生成快捷键                Alt + Insert
</span><span class="line">
</span><span class="line">自动跳转测试Test类            Alt + T
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="a-idsublimesublime-a"><a id="Sublime">Sublime 快捷键</a></h2>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>sublime keymap </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="kconfig"><span class="line">选择多行操作                          Ctrl + Shift + L
</span><span class="line">
</span><span class="line">选择单词操作，多次往下移              Ctrl + D
</span><span class="line">
</span><span class="line">选择一行操作，重复选择下一行          Ctrl + L
</span><span class="line">
</span><span class="line">注释当前行                            Ctrl + /
</span><span class="line">
</span><span class="line">从当前位置开始注释                    Ctrl + Shift + /
</span></code></pre></td></tr></table></div></figure></notextile></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/24/Linux-Software-Install-Understand/">深入理解软件包的配置、编译与安装</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-06-24T22:21:35+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>24</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:21 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>说明：来自互联网，如有版权问题，请告知本人将其撤下。</p>

<p>来源：<a href="http://works.jinbuguo.com/linux/understand_package_install.htm">http://works.jinbuguo.com/linux/understand_package_install.htm</a>l</p>

<h2 id="section">目录</h2>

<ol>
  <li><a href="#Intro">前言</a></li>
  <li><a href="#About">概述</a></li>
  <li><a href="#Make">Makefile 与 make</a></li>
  <li><a href="#Configure">configure</a></li>
</ol>

<h2 id="a-idintroa"><a id="Intro">前言</a></h2>

<p>从源代码安装过软件的朋友一定对 <code>./configure &amp;&amp; make &amp;&amp; make install</code> 安装三步曲非常熟悉了。然而究竟这个过程中的每一步幕后都发生了些什么呢？本文将带领你一探究竟。深入理解这个过程将有助于你在LFS的基础上玩出自己的花样来。不过需要说明的是本文对 <code>Makefile</code> 和 <code>make</code> 的讲解是相当近视和粗浅的，但是对于理解安装过程来说足够了。</p>

<h2 id="a-idabouta"><a id="About">概述</a></h2>

<p>用一句话来解释这个过程就是：</p>

<p>根据源码包中 Makefile.in 文件的指示，configure 脚本检查当前的系统环境和配置选项，在当前目录中生成 <code>Makefile</code> 文件(还有其它本文无需关心的文件)，然后 <code>make</code> 程序就按照当前目录中的 Makefile 文件的指示将源代码编译为二进制文件，最后将这些二进制文件移动(即安装)到指定的地方(仍然按照 <code>Makefile</code> 文件的指示)。</p>

<p>由此可见 Makefile 文件是幕后的核心。要深入理解安装过程，必须首先对 <code>Makefile</code> 文件有充分的了解。本文将首先讲述 <code>Makefile</code> 与 <code>make</code> ，然后再讲述 <code>configure</code> 脚本。并且在讲述这两部分内容时，提供了尽可能详细的、可以运用于实践的参考资料。</p>

<h2 id="a-idmakemakefile--makea"><a id="Make">Makefile 与 make</a></h2>

<p>用一句话来概括<code>Makefile</code> 与 <code>make</code> 的关系就是：</p>

<p><code>Makefile</code> 包含了所有的规则和目标，而 <code>make</code> 则是为了完成目标而去解释 <code>Makefiel</code> 规则的工具。</p>

<h3 id="make-">make 语法</h3>

<p>首先看看 <code>make</code> 的命令行语法：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux make </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">make <span class="o">[</span>options<span class="o">]</span> <span class="o">[</span>targets<span class="o">]</span> <span class="o">[</span><span class="nv">VAR</span><span class="o">=</span>VALUE<span class="o">]</span>...
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><code>[options]</code>是命令行选项，可以用 <code>make --help</code> 命令查看全部，<code>[VAR=VALUE]</code>是在命令行上指定环境变量，这两个大家都很熟悉，将在稍后详细讲解。而<code>[targets]</code>是什么呢？字面的意思是”目标”，也就是希望本次 make 命令所完成的任务。凭经验猜测，这个<code>[targets]</code>大概可以用”check”,”install”之类(也就是常见的测试和安装命令)。但是它到底是个啥玩意儿？不带任何”目标”的 <code>make</code> 命令是什么意思？为什么在安装 LFS 工具链中的 Perl-5.8.8 软件包时会出现”make perl utilities”这样怪异的命令？要回答这些问题必须首先理解 <code>Makefile</code> 文件中的”规则”。</p>

<h3 id="makefile-">Makefile 规则</h3>

<p>Makefile 规则包含了文件之间的依赖关系和更新此规则目标所需要的命令。</p>

<p>一个简单的 Makefile 规则是这样写的：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux makefile </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">TARGET : PREREQUISITES
</span><span class="line">	COMMAND
</span><span class="line">TARGET
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>规则的目标。也就是可以被 make 使用的”目标”。有些目标可以没有依赖而只有动作(命令行)，比如”clean”，通常仅仅定义一系列删除中间文件的命令。同样，有些目标可以没有动作而只有依赖，比如”all”，通常仅仅用作”终极目标”。</p>

<p><code>PREREQUISITES</code><br />
规则的依赖。通常一个目标依赖于一个或者多个文件。</p>

<p><code>COMMAND</code><br />
规则的命令行。一个规则可以有零个或多个命令行。</p>

<p>OK! 现在你明白[targets]是什么了，原来它们来自于 <code>Makefile</code> 文件中一条条规则的目标(TARGET)。另外，<code>Makefile</code>文件中第一条规则的目标被称为”终极目标”，也就是你省略[targets]参数时的目标(通常为”all”)。</p>

<p>当你查看一个实际的 <code>Makefile</code> 文件时，你会发现有些规则非常复杂，但是它都符合规则的基本格式。此外，<code>Makefile</code> 文件中通常还包含了除规则以外的其它很多东西，不过本文只关心其中的变量。</p>

<h3 id="makefile--1">Makefile 实例</h3>

<p>下面看一个简单的、实际的 <code>Makefile</code>文件：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux makefile </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="nv">CC</span><span class="o">=</span>gcc
</span><span class="line"><span class="nv">CPPFLAGS</span><span class="o">=</span>
</span><span class="line"><span class="nv">CFLAGS</span><span class="o">=</span>-O2 -pipe
</span><span class="line"><span class="nv">LDFLAGS</span><span class="o">=</span>-s
</span><span class="line"><span class="nv">PREFIX</span><span class="o">=</span>/usr
</span><span class="line">
</span><span class="line">all : prog1 prog2
</span><span class="line">
</span><span class="line">prog1 : prog1.o
</span><span class="line">	<span class="k">$(</span>CC<span class="k">)</span> <span class="k">$(</span>LDFLAGS<span class="k">)</span> -o prog1 prog1.o
</span><span class="line">
</span><span class="line">prog1.o : prog1.c
</span><span class="line">	<span class="k">$(</span>CC<span class="k">)</span> -c <span class="k">$(</span>CFLAGS<span class="k">)</span> prog1.c
</span><span class="line">
</span><span class="line">prog2 : prog2.o
</span><span class="line">	<span class="k">$(</span>CC<span class="k">)</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> <span class="k">$(</span>LDFLAGS<span class="k">)</span> -o prog2 prog2.o
</span><span class="line">
</span><span class="line">prog2.o : prog2.c
</span><span class="line">	<span class="k">$(</span>CC<span class="k">)</span> -c <span class="k">$(</span>CPPFLAGS<span class="k">)</span> <span class="k">$(</span>CFLAGS<span class="k">)</span> prog2.c
</span><span class="line">
</span><span class="line">clean :
</span><span class="line">	rm -f *.<span class="o">{</span>o,a<span class="o">}</span> prog<span class="o">{</span>1,2<span class="o">}</span>
</span><span class="line">
</span><span class="line">install : prog1 prog2
</span><span class="line">	<span class="k">if</span> <span class="o">(</span> <span class="nb">test</span> ! -d <span class="k">$(</span>PREFIX<span class="k">)</span>/bin <span class="o">)</span> <span class="p">;</span> <span class="k">then</span> mkdir -p <span class="k">$(</span>PREFIX<span class="k">)</span>/bin <span class="p">;</span> <span class="k">fi</span>
</span><span class="line">	cp -f prog1 <span class="k">$(</span>PREFIX<span class="k">)</span>/bin/prog1
</span><span class="line">	cp -f prog2 <span class="k">$(</span>PREFIX<span class="k">)</span>/bin/prog2
</span><span class="line">
</span><span class="line">check <span class="nb">test</span> : prog1 prog2
</span><span class="line">	prog1 &lt; sample1.ref &gt; sample1.rz
</span><span class="line">	prog1 &lt; sample2.ref &gt; sample3.rz
</span><span class="line">	cmp sample1.ok sample1.rz
</span><span class="line">	cmp sample2.ok sample2.rz
</span><span class="line">	
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>从中可以看出，<code>make</code> 与 <code>make all</code> 以及 <code>make prog1 prog2</code> 三条命令其实是等价的。而常用的 <code>make check</code> 和 <code>make install</code> 也找到了归属。同时我们也看到了 Makefile 中的各种变量是如何影响编译的。针对这个特定的 Makefile ，你甚至可以省略安装三步曲中的 make 命令而直接使用<code> make install</code> 进行安装。</p>

<p>同样，为了使用自定义的编译参数编译 prog2 ，我们可以使用 <code>make prog2 CFLAGS="-O3 -march=athlon64"</code> 或 <code>CFLAGS="-O3 -march=athlon64" &amp;&amp; make -e prog2</code> 命令达到此目的。</p>

<h3 id="makefile--2">Makefile 惯例</h3>

<p>下面是Makefile中一些约定俗成的目标名称及其含义：</p>

<p><code>all</code><br />
编译整个软件包，但不重建任何文档。一般此目标作为默认的终极目标。此目标一般对所有源程序的编译和连接使用”-g”选项，以使最终的可执行程序中包含调试信息。可使用 strip 程序去掉这些调试符号。</p>

<p><code>clean</code><br />
清除当前目录下在 make 过程中产生的文件。它不能删除软件包的配置文件，也不能删除 build 时创建的那些文件。</p>

<p><code>distclean</code><br />
类似于”clean”，但增加删除当前目录下的的配置文件、build 过程产生的文件。</p>

<p><code>info</code><br />
产生必要的 Info 文档。</p>

<p><code>check 或 test</code> <br />
完成所有的自检功能。在执行检查之前，应确保所有程序已经被创建(但可以尚未安装)。为了进行测试，需要实现在程序没有安装的情况下被执行的测试命令。</p>

<p><code>install</code><br />
完成程序的编译并将最终的可执行程序、库文件等拷贝到指定的目录。此种安装一般不对可执行程序进行 strip 操作。</p>

<p><code>install-strip</code><br />
和”install”类似，但是会对复制到安装目录下的可执行文件进行 strip 操作。</p>

<p><code>uninstall</code><br />
删除所有由”install”安装的文件。</p>

<p><code>installcheck</code><br />
执行安装检查。在执行安装检查之前，需要确保所有程序已经被创建并且被安装。</p>

<p><code>installdirs</code> <br />
创建安装目录及其子目录。它不能更改软件的编译目录，而仅仅是创建程序的安装目录。</p>

<p>下面是 Makefile 中一些约定俗成的变量名称及其含义：</p>

<p>这些约定俗成的变量分为三类。第一类代表可执行程序的名字，例如 CC 代表编译器这个可执行程序；第二类代表程序使用的参数(多个参数使用空格分开)，例如 CFLAGS 代表编译器执行时使用的参数(一种怪异的做法是直接在 CC 中包含参数)；第三类代表安装目录，例如 prefix 等等，含义简单，下面只列出它们的默认值。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux makefile </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">AR   函数库打包程序，可创建静态库.a文档。默认是<span class="s2">&quot;ar&quot;</span>。
</span><span class="line">AS   汇编程序。默认是<span class="s2">&quot;as&quot;</span>。
</span><span class="line">CC   C编译程序。默认是<span class="s2">&quot;cc&quot;</span>。
</span><span class="line">CXX  C++编译程序。默认是<span class="s2">&quot;g++&quot;</span>。
</span><span class="line">CPP  C/C++预处理器。默认是<span class="s2">&quot;$(CC) -E&quot;</span>。
</span><span class="line">FC   Fortran编译器。默认是<span class="s2">&quot;f77&quot;</span>。
</span><span class="line">PC   Pascal语言编译器。默认是<span class="s2">&quot;pc&quot;</span>。
</span><span class="line">YACC Yacc文法分析器。默认是<span class="s2">&quot;yacc&quot;</span>。
</span><span class="line">
</span><span class="line">ARFLAGS     函数库打包程序的命令行参数。默认值是<span class="s2">&quot;rv&quot;</span>。
</span><span class="line">ASFLAGS     汇编程序的命令行参数。
</span><span class="line">CFLAGS      C编译程序的命令行参数。
</span><span class="line">CXXFLAGS    C++编译程序的命令行参数。
</span><span class="line">CPPFLAGS    C/C++预处理器的命令行参数。
</span><span class="line">FFLAGS      Fortran编译器的命令行参数。
</span><span class="line">PFLAGS      Pascal编译器的命令行参数。
</span><span class="line">YFLAGS      Yacc文法分析器的命令行参数。
</span><span class="line">LDFLAGS     链接器的命令行参数。
</span><span class="line">
</span><span class="line">prefix      /usr/local
</span><span class="line">exec_prefix <span class="k">$(</span>prefix<span class="k">)</span>
</span><span class="line">bindir      <span class="k">$(</span>exec_prefix<span class="k">)</span>/bin
</span><span class="line">sbindir     <span class="k">$(</span>exec_prefix<span class="k">)</span>/sbin
</span><span class="line">libexecdir  <span class="k">$(</span>exec_prefix<span class="k">)</span>/libexec
</span><span class="line">datadir     <span class="k">$(</span>prefix<span class="k">)</span>/share
</span><span class="line">sysconfdir  <span class="k">$(</span>prefix<span class="k">)</span>/etc
</span><span class="line">sharedstatedir <span class="k">$(</span>prefix<span class="k">)</span>/com
</span><span class="line">localstatedir  <span class="k">$(</span>prefix<span class="k">)</span>/var
</span><span class="line">libdir      <span class="k">$(</span>exec_prefix<span class="k">)</span>/lib
</span><span class="line">infodir     <span class="k">$(</span>prefix<span class="k">)</span>/info
</span><span class="line">includedir  <span class="k">$(</span>prefix<span class="k">)</span>/include
</span><span class="line">oldincludedir  <span class="k">$(</span>prefix<span class="k">)</span>/include
</span><span class="line">mandir      <span class="k">$(</span>prefix<span class="k">)</span>/man
</span><span class="line">srcdir      需要编译的源文件所在的目录，无默认值
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="make--1">make 选项</h3>

<p>最后说说 make 的命令行选项(以Make-3.81版本为准)：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux makefile </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="sb">`</span>-B, --always-make<span class="sb">`</span>
</span><span class="line">无条件的重建所有规则的目标，而不是根据规则的依赖关系决定是否重建某些目标文件。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-C DIR, --directory<span class="o">=</span>DIR<span class="sb">`</span>
</span><span class="line">在做任何动作之前先切换工作目录到 DIR ，然后再执行 make 程序。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-d<span class="sb">`</span>
</span><span class="line">在 make 执行过程中打印出所有的调试信息。包括：make 认为那些文件需要重建；那些文件需要比较它们的最后修改时间、比较的结果；重建目标所要执行的命令；使用的隐含规则等。使用该选项我们可以看到 make 构造依赖关系链、重建目标过程的所有信息，它等效于<span class="s2">&quot;-debug=a&quot;</span>。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>--debug<span class="o">=</span>FLAGS<span class="sb">`</span>
</span><span class="line">    在 make 执行过程中打印出调试信息。FLAGS 用于控制调试信息级别：
</span><span class="line">    a 输出所有类型的调试信息
</span><span class="line">    b 输出基本调试信息。包括：那些目标过期、是否重建成功过期目标文件。
</span><span class="line">    v 除 b 级别以外还包括：解析的 makefile 文件名，不需要重建文件等。
</span><span class="line">    i 除 b 级别以外还包括：所有使用到的隐含规则描述。
</span><span class="line">    j 输出所有执行命令的子进程，包括命令执行的 PID 等。
</span><span class="line">    m 输出 make 读取、更新、执行 makefile 的信息。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-e, --environment-overrides<span class="sb">`</span>
</span><span class="line">使用系统环境变量的定义覆盖 Makefile 中的同名变量定义。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-f FILE, --file<span class="o">=</span>FILE, --makefile<span class="o">=</span>FILE<span class="sb">`</span>
</span><span class="line">将 FILE 指定为 Makefile 文件。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-h, --help<span class="sb">`</span>
</span><span class="line">打印帮助信息。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-i, --ignore-errors<span class="sb">`</span>
</span><span class="line">忽略规则命令执行过程中的错误。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-I DIR, --include-dir<span class="o">=</span>DIR<span class="sb">`</span>
</span><span class="line">指定包含 Makefile 文件的搜索目录。使用多个<span class="s2">&quot;-I&quot;</span>指定目录时，搜索目录按照指定顺序进行。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-j <span class="o">[</span>N<span class="o">]</span>, --jobs<span class="o">[=</span>N<span class="o">]</span><span class="sb">`</span>
</span><span class="line">指定并行执行的命令数目。在没有指定<span class="s2">&quot;-j&quot;</span>参数的情况下，执行的命令数目将是系统允许的最大可能数目。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-k, --keep-going<span class="sb">`</span>
</span><span class="line">遇见命令执行错误时不终止 make 的执行，也就是尽可能执行所有的命令，直到出现致命错误才终止。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-l <span class="o">[</span>N<span class="o">]</span>, --load-average<span class="o">[=</span>N<span class="o">]</span>, --max-load<span class="o">[=</span>N<span class="o">]</span><span class="sb">`</span>
</span><span class="line">如果系统负荷超过 LOAD<span class="o">(</span>浮点数<span class="o">)</span>，不再启动新任务。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-L, --check-symlink-times<span class="sb">`</span>
</span><span class="line">同时考察符号连接的时间戳和它所指向的目标文件的时间戳，以两者中较晚的时间戳为准。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-n, --just-print, --dry-run, --recon<span class="sb">`</span>
</span><span class="line">  只打印出所要执行的命令，但并不实际执行命令。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-o FILE, --old-file<span class="o">=</span>FILE, --assume-old<span class="o">=</span>FILE<span class="sb">`</span>
</span><span class="line">即使相对于它的依赖已经过期也不重建 FILE 文件；同时也不重建依赖于此文件任何文件。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-p, --print-data-base<span class="sb">`</span>
</span><span class="line">命令执行之前，打印出 make 读取的 Makefile 的所有数据（包括规则和变量的值），同时打印出 make 的版本信息。如果只需要打印这些数据信息，可以使用 make -qp 命令。查看 make 执行前的预设规则和变量，可使用命令 make -p -f /dev/null 。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-q, --question<span class="sb">`</span>
</span><span class="line"><span class="s2">&quot;询问模式&quot;</span>。不运行任何命令，并且无输出，只是返回一个查询状态。返回状态为 <span class="m">0</span> 表示没有目标需要重建，1 表示存在需要重建的目标，2 表示有错误发生。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-r, --no-builtin-rules<span class="sb">`</span>
</span><span class="line">取消所有内嵌的隐含规则，不过你可以在 Makefile 中使用模式规则来定义规则。同时还会取消所有支持后追规则的隐含后缀列表，同样我们也可以在 Makefile 中使用<span class="s2">&quot;.SUFFIXES&quot;</span>定义我们自己的后缀规则。此选项不会取消 make 内嵌的隐含变量。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-R, --no-builtin-variables<span class="sb">`</span>
</span><span class="line">取消 make 内嵌的隐含变量，不过我们可以在 Makefile 中明确定义某些变量。注意，此选项同时打开了<span class="s2">&quot;-r&quot;</span>选项。因为隐含规则是以内嵌的隐含变量为基础的。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-s, --silent, --quiet<span class="sb">`</span>
</span><span class="line">不显示所执行的命令。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-S, --no-keep-going, --stop<span class="sb">`</span>
</span><span class="line">取消<span class="s2">&quot;-k&quot;</span>选项。在递归的 make 过程中子 make 通过 MAKEFLAGS 变量继承了上层的命令行选项。我们可以在子 make 中使用<span class="s2">&quot;-S&quot;</span>选项取消上层传递的<span class="s2">&quot;-k&quot;</span>选项，或者取消系统环境变量 MAKEFLAGS 中的<span class="s2">&quot;-k&quot;</span>选项。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-t, --touch<span class="sb">`</span>
</span><span class="line">更新所有目标文件的时间戳到当前系统时间。防止 make 对所有过时目标文件的重建。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-v, --version<span class="sb">`</span>
</span><span class="line">打印版本信息。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-w, --print-directory<span class="sb">`</span>
</span><span class="line">在 make 进入一个目录之前打印工作目录。使用<span class="s2">&quot;-C&quot;</span>选项时默认打开这个选项。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>--no-print-directory <span class="sb">`</span>
</span><span class="line">取消<span class="s2">&quot;-w&quot;</span>选项。可以是用在递归的 make 调用过程中，取消<span class="s2">&quot;-C&quot;</span>参数将默认打开<span class="s2">&quot;-w&quot;</span>。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>-W FILE, --what-if<span class="o">=</span>FILE, --new-file<span class="o">=</span>FILE, --assume-new<span class="o">=</span>FILE<span class="sb">`</span>
</span><span class="line">设定 FILE 文件的时间戳为当前时间，但不改变文件实际的最后修改时间。此选项主要是为实现了对所有依赖于 FILE 文件的目标的强制重建。
</span><span class="line">
</span><span class="line"><span class="sb">`</span>--warn-undefined-variables <span class="sb">`</span>
</span><span class="line">在发现 Makefile 中存在对未定义的变量进行引用时给出告警信息。此功能可以帮助我们调试一个存在多级套嵌变量引用的复杂 Makefile 。但是：我们建议在书写 Makefile 时尽量避免超过三级以上的变量套嵌引用。
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="a-idconfigureconfigurea"><a id="Configure">configure</a></h2>

<p>此阶段的主要目的是生成 Makefile 文件，是最关键的运筹帷幄阶段，基本上所有可以对安装过程进行的个性化调整都集中在这一步。</p>

<p>configure 脚本能够对 Makefile 中的哪些内容产生影响呢？基本上可以这么说：所有内容，包括本文最关心的 Makefile 规则与 Makefile 变量。那么又是哪些因素影响着最终生成的 Makefile 文件呢？答曰：系统环境和配置选项。</p>

<p>配置选项的影响是显而易见的。但是”系统环境”的概念却很宽泛，包含很多方面内容，不过我们这里只关心环境变量，具体说来就是将来会在 Makefile 中使用到的环境变量以及与 Makefile 中的变量同名的环境变量。</p>

<h3 id="configure-">通用 configure 语法</h3>

<p>在进一步讲述之前，先看看 configure 脚本的语法，一般有两种：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux configure </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">configure <span class="o">[</span>OPTIONS<span class="o">]</span> <span class="o">[</span><span class="nv">VAR</span><span class="o">=</span>VALUE<span class="o">]</span>...
</span><span class="line">
</span><span class="line">configure <span class="o">[</span>OPTIONS<span class="o">]</span> <span class="o">[</span>HOST<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>不管是哪种语法，我们都可以用 <code>configure --help</code> 查看所有可用的<code>[OPTIONS]</code>，并且通常在结尾部分还能看到这个脚本所关心的环境变量有哪些。在本文中将对这两种语法进行合并，使用下面这种简化的语法：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux configure </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">configure <span class="o">[</span>OPTIONS<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>这种语法能够被所有的 <code>configure</code> 脚本所识别，同时也能通过设置环境变量和使用特定的<code>[OPTIONS]</code>完成上述两种语法的一切功能。</p>

<h3 id="configure--1">通用 configure 选项</h3>

<p>虽然每个软件包的 configure 脚本千差万别，但是它们却都有一些共同的选项，也基本上都遵守相同的选项语法。</p>

<p><strong>脚本自身选项</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux configure </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">--help
</span><span class="line">显示帮助信息。
</span><span class="line">
</span><span class="line">--version
</span><span class="line">显示版本信息。
</span><span class="line">
</span><span class="line">--cache-file<span class="o">=</span>FILE
</span><span class="line">在FILE文件中缓存测试结果<span class="o">(</span>默认禁用<span class="o">)</span>。
</span><span class="line">
</span><span class="line">--no-create
</span><span class="line">configure脚本运行结束后不输出结果文件，常用于正式编译前的测试。
</span><span class="line">
</span><span class="line">--quiet, --silent
</span><span class="line">不显示脚本工作期间输出的<span class="s2">&quot;checking ...&quot;</span>消息。
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>目录选项</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux configure </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">--srcdir<span class="o">=</span>DIR
</span><span class="line">源代码文件所在目录，默认为configure脚本所在目录或其父目录。
</span><span class="line">
</span><span class="line">--prefix<span class="o">=</span>PREFIX
</span><span class="line">体系无关文件的顶级安装目录PREFIX ，默认值一般是 /usr/local 或 /usr/local/pkgName
</span><span class="line">
</span><span class="line">--exec-prefix<span class="o">=</span>EPREFIX
</span><span class="line">体系相关文件的顶级安装目录EPREFIX ，默认值一般是 PREFIX
</span><span class="line">
</span><span class="line">--bindir<span class="o">=</span>DIR
</span><span class="line">用户可执行文件的存放目录DIR ，默认值一般是 EPREFIX/bin
</span><span class="line">
</span><span class="line">--sbindir<span class="o">=</span>DIR
</span><span class="line">系统管理员可执行目录DIR ，默认值一般是 EPREFIX/sbin
</span><span class="line">
</span><span class="line">--libexecdir<span class="o">=</span>DIR
</span><span class="line">程序可执行目录DIR ，默认值一般是 EPREFIX/libexec
</span><span class="line">
</span><span class="line">--datadir<span class="o">=</span>DIR
</span><span class="line">通用数据文件的安装目录DIR ，默认值一般是 PREFIX/share
</span><span class="line">
</span><span class="line">--sysconfdir<span class="o">=</span>DIR
</span><span class="line">只读的单一机器数据目录DIR ，默认值一般是 PREFIX/etc
</span><span class="line">
</span><span class="line">--sharedstatedir<span class="o">=</span>DIR
</span><span class="line">可写的体系无关数据目录DIR ，默认值一般是 PREFIX/com
</span><span class="line">
</span><span class="line">--localstatedir<span class="o">=</span>DIR
</span><span class="line">可写的单一机器数据目录DIR ，默认值一般是 PREFIX/var
</span><span class="line">
</span><span class="line">--libdir<span class="o">=</span>DIR
</span><span class="line">库文件的安装目录DIR ，默认值一般是 EPREFIX/lib
</span><span class="line">
</span><span class="line">--includedir<span class="o">=</span>DIR
</span><span class="line">C头文件目录DIR ，默认值一般是 PREFIX/include
</span><span class="line">
</span><span class="line">--oldincludedir<span class="o">=</span>DIR
</span><span class="line">非gcc的C头文件目录DIR ，默认值一般是 /usr/include
</span><span class="line">
</span><span class="line">--infodir<span class="o">=</span>DIR
</span><span class="line">Info文档的安装目录DIR ，默认值一般是 PREFIX/info
</span><span class="line">
</span><span class="line">--mandir<span class="o">=</span>DIR
</span><span class="line">Man文档的安装目录DIR ，默认值一般是 PREFIX/man
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>体系结构选项</strong></p>

<p>玩交叉编译的朋友对这些选项已经很熟悉了，对于不使用交叉编译的朋友也不必担心，不要理它们就可以了。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux configure </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">--build<span class="o">=</span>BUILD
</span><span class="line">工具链当前的运行环境，默认是 config.guess 脚本的输出结果。
</span><span class="line">
</span><span class="line">--host<span class="o">=</span>HOST
</span><span class="line">编译出的二进制代码将要运行在HOST上，默认值是BUILD。
</span><span class="line">
</span><span class="line">--target<span class="o">=</span>TARGET
</span><span class="line">编译出的工具链所将来生成的二进制代码要在TARGET上运行，这个选项仅对工具链<span class="o">(</span>也就是GCC和Binutils两者<span class="o">)</span>有意义。
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>特性选项</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux configure </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">--enable-FEATURE
</span><span class="line">启用FEATURE特性
</span><span class="line">
</span><span class="line">--disable-FEATURE
</span><span class="line">禁用FEATURE特性
</span><span class="line">
</span><span class="line">--with-PACKAGE<span class="o">[=</span>DIR<span class="o">]</span>
</span><span class="line">启用附加软件包PACKAGE，亦可同时指定PACKAGE所在目录DIR
</span><span class="line">
</span><span class="line">--without-PACKAGE
</span><span class="line">禁用附加软件包PACKAGE
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>通用环境变量</strong></p>

<p>除了上述通用的选项外，下列环境变量影响着最终生成的 Makefile 文件：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux configure </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">CPP
</span><span class="line">C预处理器命令
</span><span class="line">
</span><span class="line">CXXCPP
</span><span class="line">C++预处理器命令
</span><span class="line">
</span><span class="line">CPPFLAGS
</span><span class="line">C/C++预处理器命令行参数
</span><span class="line">
</span><span class="line">CC
</span><span class="line">C编译器命令
</span><span class="line">
</span><span class="line">CFLAGS
</span><span class="line">C编译器命令行参数
</span><span class="line">
</span><span class="line">CXX
</span><span class="line">C++编译器命令
</span><span class="line">
</span><span class="line">CXXFLAGS
</span><span class="line">C++编译器命令行参数
</span><span class="line">
</span><span class="line">LDFLAGS
</span><span class="line">连接器命令行参数
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>至于设置这些环境变量的方法，你可以将它们 <code>export</code> 为全局变量在全局范围内使用，也可以在命令行上使用 <code>[VAR=VALUE]... configure [OPTIONS]</code> 的语法局部使用。此处就不详细描述了。</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/10/Ubuntu-Chrome-Start-Fail-Resolve/">Ubuntu Chrome启动失败解决方法</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-06-10T22:21:35+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>10</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:21 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="section">目录</h2>

<ol>
  <li><a href="#Intro">前言</a></li>
  <li><a href="#Chrome">Chrome启动失败解决方法</a></li>
  <li><a href="#Finally">小结</a></li>
</ol>

<h2 id="a-idintroa"><a id="Intro">前言</a></h2>

<p>使用<code>Ubuntu</code>系统时，由于系统是默认安装的，所以机器名没有修改成一个合适的名字。在<code>Ubuntu</code>下通过命令<code>sudo vim /etc/hostname</code>来修改成自己想要的命令，然后注销用户，重新进入系统。</p>

<p>接着，就出现了一个很奇怪的问题，我的桌面上的chrome图标不能点击进入，一直都是无响应状态，但是其他浏览器，比如自带的<code>Firefox</code>就可以正常启动和使用。</p>

<h2 id="a-idchromechromea"><a id="Chrome">Chrome启动失败解决方法</a></h2>

<p>点击<code>chrome</code>图标不管用，并且看不到任何出错信息，无法定位问题出在哪里。只好，从<code>终端</code>使用<code>google-chrome</code>命令来启动<code>chrome</code>浏览器客户端了。于是，出现以下错误信息：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux install chrome </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">ketao@ketao-Latitude:~<span class="nv">$ </span>google-chrome
</span><span class="line">
</span><span class="line"><span class="o">[</span>5901:5901:0610/183033:ERROR:process_singleton_linux.cc<span class="o">(</span>309<span class="o">)]</span> 其他计算机 <span class="o">(</span>ketao-Latitude-E5430-non-vPro<span class="o">)</span> 的另一个 Google Chrome 进程 <span class="o">(</span>7578<span class="o">)</span> 好像正在使用此个人资料。Chrome 已锁定此个人资料以防止其受损。如果您确定其他进程目前未使用此个人资料，请为其解锁并重新启动 Chrome。
</span><span class="line">
</span><span class="line"><span class="o">[</span>5901:5901:0610/183033:ERROR:simple_message_box_views.cc<span class="o">(</span>208<span class="o">)]</span> Unable to show a dialog outside the UI thread message loop: Google Chrome - 其他计算机 <span class="o">(</span>ketao-Latitude-E5430-non-vPro<span class="o">)</span> 的另一个 Google Chrome 进程 <span class="o">(</span>7578<span class="o">)</span> 好像正在使用此个人资料。Chrome 已锁定此个人资料以防止其受损。如果您确定其他进程目前未使用此个人资料，请为其解锁并重新启动 Chrome。
</span></code></pre></td></tr></table></div></figure></notextile></div>

<blockquote>
  <blockquote>
    <p>Note：显然，上面的错误信息告诉我们，尼玛，<code>chrome</code>会记录我们在计算机上的操作数据在本地，然后我们修改主机名后，导致老数据被锁住了，这样新的主机名下chrome无法获取用户对应的浏览器数据，因此chrome无法正常启动，并且在UI上还无法看到相关错误，导致假死现象出现。</p>
  </blockquote>
</blockquote>

<h3 id="section-1">解决方法：</h3>

<p>先把本机上的<code>chrome</code>卸载掉，当然这不会把那些被锁定的数据也一并删除掉，不然我也不会写一篇博客记录下。因此，接下来，你需要删除掉自个目录下的残留的<code>chrome</code>用户数据。</p>

<p>在当前用户目录下面执行命令：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux install chrome </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">ketao@ketao-Latitude:~<span class="nv">$ </span><span class="nb">cd</span> .config/
</span><span class="line">ketao@ketao-Latitude:~/.config<span class="nv">$ </span>ls
</span><span class="line">chromium        gedit             monitors.xml     Trolltech.conf
</span><span class="line">compiz-1        gnome-session     nautilus         ubuntu-ui-toolkit
</span><span class="line">dconf           google-chrome     pulse            update-notifier
</span><span class="line">enchant         gtk-2.0           ReText project   upstart
</span><span class="line">evolution       gtk-3.0           software-center  user-dirs.dirs
</span><span class="line">fcitx           ibus              SogouPY          user-dirs.locale
</span><span class="line">fcitx-qimpanel  libaccounts-glib  SogouPY.users    VirtualBox
</span><span class="line">ketao@ketao-Latitude:~/.config<span class="nv">$ </span>rm -rf chromium/
</span><span class="line">ketao@ketao-Latitude:~/.config<span class="nv">$ </span>rm -rf google-chrome/
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>然后，重装<code>chrome</code>浏览器，安装成功之后，就可以启动<code>chrome</code>了。</p>

<h2 id="a-idfinallya"><a id="Finally">小结</a></h2>

<p>一般，如果程序出现问题，通过重装都无法解决的，都是应用在用户目录下面添加来一些配置文件，并且这些文件在应用卸载之后并不会删除，所以会出现重装失败的问题。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/04/Ubuntu-Software-Configure-and-Install/">Ubuntu Subversion软件安装和配置</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-06-04T22:21:35+08:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:21 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="section">目录</h2>

<ol>
  <li><a href="#Intro">前言</a></li>
  <li><a href="#Subversion">subversion安装和配置</a></li>
  <li><a href="#Finally">小结</a></li>
</ol>

<h2 id="a-idintroa"><a id="Intro">前言</a></h2>

<p>最近，系统从 <code>windows</code>切换到<code>Ubuntu</code>，一些开发软件需要重新安装和配置。但是，众所周知，<code>windows</code>上的开发软件客户端比<code>ubuntu</code>等linux系系统使用要便捷和傻瓜得多，所以切换到<code>ubuntu</code>有很多软件需要安装，但是这些软件需要进行代码编译，就在这里记录下。</p>

<h2 id="a-idsubversionsubversiona"><a id="Subversion">subversion安装和配置</a></h2>

<p>一般，如果对<code>subversion</code>的版本不限制，那些直接使用<code>sudo apt-get install subversion</code>命令就可以安装来，但是如果对版本有要求，比如由于<code>svn</code>的1.8版本在很多<code>svn</code>服务器端不被支持，所以需要安装低于1.8的svn客户端。这就需要我们在本地编译完了之后再安装。</p>

<h3 id="subversion">2.1 subversion源码下载</h3>

<p>点击进入下载页面：<a href="http://subversion.apache.org/download/#supported-releases">http://subversion.apache.org/download/#supported-releases</a> , 选择当前最新的<code>1.7</code>的子版本下载；</p>

<p>或者，也可以直接在终端使用命令：<code>wget http://apache.fayea.com/apache-mirror/subversion/subversion-1.7.17.tar.gz</code>下载。</p>

<h3 id="subversion-">2.2 subversion 源码编译准备</h3>

<p>在<code>Linux</code>编译安装<code>subversion</code>需要事先准备很多的工作，安装很多相关的工具包，否则代码无法编译通过。因此，在安装<code> subversion</code>之前，需要先做一些准备工作。</p>

<h3 id="autoconf--libtool">2.2.1 安装 autoconf 和 libtool</h3>

<p>编译<code>subversion</code>首先需要安装<code>autoconf</code>和<code>libtool</code>两个工具，如果你的电脑上没有安装这两个工具包，很简单，直接执行安装命令就可以来了：</p>

<pre><code>1.  sudo apt-get install autoconf

2.  sudo apt-get install libtool
</code></pre>

<p>但是，如果你就接下来运行<code>./configure</code>命令，则会出现下面错误:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux install software </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class="kconfig"><span class="line">configure: Apache Portable Runtime <span class="p">(</span>APR) library configuration
</span><span class="line">checking for APR... no
</span><span class="line">configure: WARNING: APR not found
</span><span class="line">The Apache Portable Runtime <span class="p">(</span>APR) library cannot be found.
</span><span class="line">Please install APR on this system and supply the appropriate
</span><span class="line">--with-apr <span class="k">option</span> to <span class="s1">&#39;configure&#39;</span>
</span><span class="line">
</span><span class="line">or
</span><span class="line">
</span><span class="line">get it with SVN and put it in a subdirectory of this <span class="k">source</span>:
</span><span class="line">
</span><span class="line">   svn co \
</span><span class="line">    http://svn.apache.org/repos/asf/apr/apr/branches/1.3.x \
</span><span class="line">    apr
</span><span class="line">
</span><span class="line">Run that right here in the top level of the Subversion tree.
</span><span class="line">Afterwards, run apr/buildconf in that subdirectory and
</span><span class="line">then run configure again here.
</span><span class="line">
</span><span class="line">Whichever of the above you do, you probably need to do
</span><span class="line">something similar for apr-util, either providing both
</span><span class="line">--with-apr and --with-apr-util to <span class="s1">&#39;configure&#39;</span>, or
</span><span class="line">getting both from SVN with:
</span><span class="line">
</span><span class="line">   svn co \
</span><span class="line">    http://svn.apache.org/repos/asf/apr/apr-util/branches/1.3.x \
</span><span class="line">    apr-util
</span><span class="line">
</span><span class="line">configure: error: no suitable apr found
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="apr">2.2.2 安装 APR</h3>

<p>因此，你还需要<code>APR</code>,首先，在安装<code>apr</code>之前需要<code>sqlite-autoconf</code>，因此<code>subversion</code>需要使用<code>sqlite</code>来存储数据。</p>

<ol>
  <li>sqlite-autoconf：<a href="http://www.sqlite.org/2014/sqlite-autoconf-3080403.tar.gz">http://www.sqlite.org/2014/sqlite-autoconf-3080403.tar.gz</a></li>
</ol>

<p>解压缩文件，然后在<code>subversion-1.7.17</code>目录下面，新建一个目录<code>sqlite-amalgamation</code>，然后在目录下面，从解压缩后的<code>sqlite-autoconf</code>目录里面复制一个文件<code>sqlite3.c</code>到该新建目录中。</p>

<blockquote>
  <blockquote>
    <p>Note：需要注意的是，新建目录名必须为<code>sqlite-amalgamation</code>，虽然下载的文件是<code>sqlite-autoconf</code>，这主要是因为<code>sqlite-autoconf</code>工具是由<code>sqlite-amalgamation</code>来的，后来改了名字了，但是<code>subversion</code>编译的时候，并没有改变相应代码配置，所以还是需要用原来的命名。</p>
  </blockquote>
</blockquote>

<p>接下来，就可以下载apr.tar.gz和apr-util.tar.gz两个源码包：</p>

<ol>
  <li>
    <p>apr：<a href="http://mirrors.cnnic.cn/apache//apr/apr-1.5.1.tar.gz">http://mirrors.cnnic.cn/apache//apr/apr-1.5.1.tar.gz</a></p>
  </li>
  <li>
    <p>apr-util：<a href="http://mirrors.cnnic.cn/apache//apr/apr-util-1.5.3.tar.gz">http://mirrors.cnnic.cn/apache//apr/apr-util-1.5.3.tar.gz</a></p>
  </li>
</ol>

<p>解压缩完了之后，分别在<code>subversion-1.7.17</code>目录下面新建<code>apr</code>目录和<code>apr-util</code>目录，然后把解压缩后的内容复制到对应的新建目录中，分别执行<code>./buildconf</code></p>

<blockquote>
  <blockquote>
    <p>Note：这里的目录名字不能改变，必须为<code>apr</code>和<code>apr-util</code>，否则会编译失败。</p>
  </blockquote>
</blockquote>

<p>当然，在这里运行<code>./configure</code>还是会出现问题，错误如下：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux install software </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">checking zlib.h usability... no
</span><span class="line">checking zlib.h presence... no
</span><span class="line">checking <span class="k">for</span> zlib.h... no
</span><span class="line">configure: error: subversion requires zlib
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="zlib">2.2.3 安装 zlib</h3>

<p>好吧，这里还需要<code>zlib</code>库，所以接下来，还需要下载<code>zlib</code>源码包：</p>

<ol>
  <li>zlib：<a href="http://cznic.dl.sourceforge.net/project/libpng/zlib/1.2.8/zlib-1.2.8.tar.gz">http://cznic.dl.sourceforge.net/project/libpng/zlib/1.2.8/zlib-1.2.8.tar.gz</a></li>
</ol>

<p>然后解压缩，在<code>subversion-1.7.17</code>目录下面，新建一个<code>zlib</code>目录，然后把解压缩的内容复制到该目录下，执行<code>./configure --shared</code>，然后在<code>make</code>，OK了。</p>

<h3 id="neon">2.2.4 安装 neon</h3>

<p>如果不安装<code>neon</code>库，在使用<code>svn co http://...</code> 的时候，则会出现错误。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux install software </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">svn: E170000: Unrecognized URL scheme <span class="k">for</span> http...
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>因此，我们需要安装<code>neon</code>库来提供<code>HTTP</code>库给svn工具使用。在安装<code>neon</code>前需要安装<code>libxml2</code>和<code>libxml2-dev</code>，直接使用<code>sudo apt-get install </code>安装就可以了。</p>

<p>然后，下载neon，地址为：<a href="http://www.webdav.org/neon/neon-0.30.0.tar.gz">http://www.webdav.org/neon/neon-0.30.0.tar.gz</a>，解压缩之后，进入目录，执行<code>./configure</code>、<code>make</code>、<code>sudo make install</code>。</p>

<h3 id="subversion-1">2.3 subversion源码编译安装</h3>

<p>准备工作做好了之后，就可以开始编译安装了。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux install software </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"> ./configure --with-neon<span class="o">=</span>/usr/local <span class="nv">CPPFLAGS</span><span class="o">=</span><span class="s2">&quot;-I/home/ketao/java/subversion-1.7.17/zlib/ -L/home/ketao/java/subversion-1.7.17/zlib/&quot;</span>
</span><span class="line">make
</span><span class="line">make install
</span></code></pre></td></tr></table></div></figure></notextile></div>

<blockquote>
  <blockquote>
    <p>Note：网上嗖的时候，说是<code>./configure CPPFLAGS="-Izlib/ -Lzlib/"</code>就可以，但是在执行的时候出现问题，找不到<code>zlib</code>目录，所以需要写绝对路径。</p>
  </blockquote>
</blockquote>

<p>接下来，你可以在终端执行命名，查看安装版本是否正确。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux install software </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">svnversion --version
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>然后会出现：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>Linux install software </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">svnversion, version 1.7.17 <span class="o">(</span>r1591372<span class="o">)</span>
</span><span class="line">   compiled Jun  <span class="m">4</span> 2014, 17:39:27
</span><span class="line">
</span><span class="line">Copyright <span class="o">(</span>C<span class="o">)</span> <span class="m">2014</span> The Apache Software Foundation.
</span><span class="line">This software consists of contributions made by many people<span class="p">;</span> see the NOTICE
</span><span class="line">file <span class="k">for</span> more information.
</span><span class="line">Subversion is open <span class="nb">source </span>software, see http://subversion.apache.org/
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="a-idfinallya"><a id="Finally">小结</a></h2>

<p>Linux下面安装软件，通过编译安装实在是比较复杂，有时候，涉及到多个类库，需要一个个去下载编译安装，比较麻烦。所以，一般情况下，推荐使用<code>apt-get install </code>来打包安装。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/3">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/index.html">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>本人</h1>
  <p>技术还处于半吊子的开发攻城狮。爱好各种技术，崇拜各种技术大牛达人。始终觉得，好记忆不如烂笔头。<a href="/about/">更多介绍...</a></p>
  <p>声明：本站使用的图片等，甚至部分文章都来自网络，原作者享有对著作的一切权利。</p>
  <p>欢迎在新浪微博上关注我：<wb:follow-button uid="2265041632" type="gray_3" width="100%" height="24" ></wb:follow-button></p>
</section><section>
  <h1>最新文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/09/05/zookeeper-programmer-guide/">Zookeeper 编程指南</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/30/nginx-proxy-configure-and-sduty/">Nginx 反向代理配置和工作原理</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/29/Redis-Cookbook-Analytics-Time-Based-Data/">Redis Cookbook 之 使用Redis存储基于时间序列的数据和进行分析</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/28/Redis-Cookbook-Inverted-Index-Text-Search/">Redis Cookbook 之 基于Redis 实现倒序索引全文搜索</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/20/Redis-Cookbook-Chat-System/">Redis Cookbook 之 基于Redis 实现一个聊天系统</a>
      </li>
    
  </ul>
</section>

<section> 
  <h1>文章分类</h1> 
  <ul id="categories"> 
    <li class='category'><a href='/blog/categories/gc/'>gc (1)</a></li>
<li class='category'><a href='/blog/categories/ide/'>ide (2)</a></li>
<li class='category'><a href='/blog/categories/java/'>java (11)</a></li>
<li class='category'><a href='/blog/categories/json/'>json (1)</a></li>
<li class='category'><a href='/blog/categories/linux/'>linux (5)</a></li>
<li class='category'><a href='/blog/categories/log/'>log (1)</a></li>
<li class='category'><a href='/blog/categories/mysql/'>mysql (3)</a></li>
<li class='category'><a href='/blog/categories/nginx/'>nginx (1)</a></li>
<li class='category'><a href='/blog/categories/python/'>python (1)</a></li>
<li class='category'><a href='/blog/categories/redis/'>redis (6)</a></li>
<li class='category'><a href='/blog/categories/redis-cookbook/'>redis cookbook (6)</a></li>
<li class='category'><a href='/blog/categories/script/'>script (3)</a></li>
<li class='category'><a href='/blog/categories/spring/'>spring (1)</a></li>
<li class='category'><a href='/blog/categories/thread/'>thread (2)</a></li>
<li class='category'><a href='/blog/categories/tools/'>tools (2)</a></li>
<li class='category'><a href='/blog/categories/translation/'>translation (1)</a></li>
<li class='category'><a href='/blog/categories/zookeeper/'>zookeeper (1)</a></li>
 
  </ul> 
</section><section id="tag-clouds" style="text-decoration:none">
<h1>最新评论</h1>
  <!-- UYAN NEW COMMENT BEGIN -->
<div id="uyan_newcmt_unit"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1933358"></script> <!-- 如果已经过加载此行JS，即可不用重复加载 -->
<!-- UYAN NEW COMMENT END -->
</section>
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - 柯小小西 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>-感谢<a href="https://github.com"> Github </a> 提供Page功能</span>
</p>

</footer>
  





</body>
</html>
