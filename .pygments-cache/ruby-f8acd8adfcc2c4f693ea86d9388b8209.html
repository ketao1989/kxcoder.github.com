<div class="highlight"><pre><span class="o">&lt;</span><span class="sr">/p&gt;</span>

<span class="sr">&lt;p&gt;def id_for_document(filename)</span>
<span class="sr">    doc_id = $redis.hget(“documents”, filename) </span>
<span class="sr">    if doc_id.nil?</span>
<span class="sr">        doc_id = $redis.incr(“next_document_id”) </span>
<span class="sr">        $redis.hset(“documents”, filename, doc_id) </span>
<span class="sr">        $redis.hset(“filenames”, doc_id, filename)</span>
<span class="sr">    end</span>
<span class="sr">    doc_id </span>
<span class="sr">end&lt;/</span><span class="nb">p</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="nb">p</span><span class="o">&gt;</span><span class="no">STOP_WORDS</span> <span class="o">=</span> <span class="o">[</span><span class="err">“</span><span class="n">the</span><span class="err">”</span><span class="p">,</span> <span class="err">“</span><span class="n">of</span><span class="err">”</span><span class="p">,</span> <span class="err">“</span><span class="n">to</span><span class="err">”</span><span class="p">,</span> <span class="err">“</span><span class="ow">and</span><span class="err">”</span><span class="p">,</span> <span class="err">“</span><span class="n">a</span><span class="err">”</span><span class="p">,</span> <span class="err">“</span><span class="k">in</span><span class="err">”</span><span class="p">,</span> <span class="err">“</span><span class="n">is</span><span class="err">”</span><span class="p">,</span> <span class="err">“</span><span class="n">it</span><span class="err">”</span><span class="p">,</span> <span class="err">“</span><span class="n">you</span><span class="err">”</span><span class="p">,</span> <span class="err">“</span><span class="n">that</span><span class="err">”</span><span class="o">]</span> <span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">doc_id</span> <span class="o">=</span> <span class="n">id_for_document</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">each_line</span> <span class="k">do</span> <span class="o">|</span><span class="n">l</span><span class="o">|</span>
    <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/ |,|)|(|\;|./</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">word</span><span class="o">|</span>
        <span class="n">continue</span> <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">size</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">=</span> <span class="mi">3</span> <span class="o">||</span> <span class="no">STOP_WORDS</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> 
        <span class="n">add_word</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">doc_id</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span><span class="o">&lt;</span><span class="sr">/p&gt;</span>

<span class="sr">&lt;p&gt;</span>
</pre></div>